<!DOCTYPE html>
<!-- Generated by Cython 0.29.21 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: beam_calc.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
pre { line-height: 125%; }
td.linenos pre { color: #000000; background-color: #f0f0f0; padding-left: 5px; padding-right: 5px; }
span.linenos { color: #000000; background-color: #f0f0f0; padding-left: 5px; padding-right: 5px; }
td.linenos pre.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.cython .hll { background-color: #ffffcc }
.cython { background: #f8f8f8; }
.cython .c { color: #408080; font-style: italic } /* Comment */
.cython .err { border: 1px solid #FF0000 } /* Error */
.cython .k { color: #008000; font-weight: bold } /* Keyword */
.cython .o { color: #666666 } /* Operator */
.cython .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.cython .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.cython .cp { color: #BC7A00 } /* Comment.Preproc */
.cython .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.cython .c1 { color: #408080; font-style: italic } /* Comment.Single */
.cython .cs { color: #408080; font-style: italic } /* Comment.Special */
.cython .gd { color: #A00000 } /* Generic.Deleted */
.cython .ge { font-style: italic } /* Generic.Emph */
.cython .gr { color: #FF0000 } /* Generic.Error */
.cython .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.cython .gi { color: #00A000 } /* Generic.Inserted */
.cython .go { color: #888888 } /* Generic.Output */
.cython .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.cython .gs { font-weight: bold } /* Generic.Strong */
.cython .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.cython .gt { color: #0044DD } /* Generic.Traceback */
.cython .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.cython .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.cython .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.cython .kp { color: #008000 } /* Keyword.Pseudo */
.cython .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.cython .kt { color: #B00040 } /* Keyword.Type */
.cython .m { color: #666666 } /* Literal.Number */
.cython .s { color: #BA2121 } /* Literal.String */
.cython .na { color: #7D9029 } /* Name.Attribute */
.cython .nb { color: #008000 } /* Name.Builtin */
.cython .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.cython .no { color: #880000 } /* Name.Constant */
.cython .nd { color: #AA22FF } /* Name.Decorator */
.cython .ni { color: #999999; font-weight: bold } /* Name.Entity */
.cython .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.cython .nf { color: #0000FF } /* Name.Function */
.cython .nl { color: #A0A000 } /* Name.Label */
.cython .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.cython .nt { color: #008000; font-weight: bold } /* Name.Tag */
.cython .nv { color: #19177C } /* Name.Variable */
.cython .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.cython .w { color: #bbbbbb } /* Text.Whitespace */
.cython .mb { color: #666666 } /* Literal.Number.Bin */
.cython .mf { color: #666666 } /* Literal.Number.Float */
.cython .mh { color: #666666 } /* Literal.Number.Hex */
.cython .mi { color: #666666 } /* Literal.Number.Integer */
.cython .mo { color: #666666 } /* Literal.Number.Oct */
.cython .sa { color: #BA2121 } /* Literal.String.Affix */
.cython .sb { color: #BA2121 } /* Literal.String.Backtick */
.cython .sc { color: #BA2121 } /* Literal.String.Char */
.cython .dl { color: #BA2121 } /* Literal.String.Delimiter */
.cython .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.cython .s2 { color: #BA2121 } /* Literal.String.Double */
.cython .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.cython .sh { color: #BA2121 } /* Literal.String.Heredoc */
.cython .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.cython .sx { color: #008000 } /* Literal.String.Other */
.cython .sr { color: #BB6688 } /* Literal.String.Regex */
.cython .s1 { color: #BA2121 } /* Literal.String.Single */
.cython .ss { color: #19177C } /* Literal.String.Symbol */
.cython .bp { color: #008000 } /* Name.Builtin.Pseudo */
.cython .fm { color: #0000FF } /* Name.Function.Magic */
.cython .vc { color: #19177C } /* Name.Variable.Class */
.cython .vg { color: #19177C } /* Name.Variable.Global */
.cython .vi { color: #19177C } /* Name.Variable.Instance */
.cython .vm { color: #19177C } /* Name.Variable.Magic */
.cython .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 0.29.21</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="beam_calc.c">beam_calc.c</a></p>
<div class="cython"><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">001</span>: <span class="k">cimport</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre>
<pre class='cython code score-8 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">002</span>: <span class="k">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">003</span>: <span class="k">import</span> <span class="nn">cython</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">004</span>: <span class="k">from</span> <span class="nn">libc.string</span> <span class="k">cimport</span> <span class="n">memcmp</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">005</span>: <span class="k">from</span> <span class="nn">libc.math</span> <span class="k">cimport</span> <span class="n">log</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">006</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>: <span class="c"># Numpy must be initialized. When using numpy from C or Cython you must</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">008</span>: <span class="c"># *ALWAYS* do that, or you will have segfaults</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">009</span>: <span class="n">np</span><span class="o">.</span><span class="n">import_array</span><span class="p">()</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_f_5numpy_import_array();<span class='error_goto'> if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 9, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">010</span>: </pre>
<pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">011</span>: <span class="k">def</span> <span class="nf">init_fftw</span><span class="p">():</span></pre>
<pre class='cython code score-14 '>/* Python wrapper */
static PyObject *__pyx_pw_6pyrost_3bin_9beam_calc_1init_fftw(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_6pyrost_3bin_9beam_calc_init_fftw[] = "init_fftw()";
static PyMethodDef __pyx_mdef_6pyrost_3bin_9beam_calc_1init_fftw = {"init_fftw", (PyCFunction)__pyx_pw_6pyrost_3bin_9beam_calc_1init_fftw, METH_NOARGS, __pyx_doc_6pyrost_3bin_9beam_calc_init_fftw};
static PyObject *__pyx_pw_6pyrost_3bin_9beam_calc_1init_fftw(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("init_fftw (wrapper)", 0);
  __pyx_r = __pyx_pf_6pyrost_3bin_9beam_calc_init_fftw(__pyx_self);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6pyrost_3bin_9beam_calc_init_fftw(CYTHON_UNUSED PyObject *__pyx_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("init_fftw", 0);
/* … */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.init_fftw", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_6pyrost_3bin_9beam_calc_1init_fftw, 0, __pyx_n_s_init_fftw, NULL, __pyx_n_s_pyrost_bin_beam_calc, __pyx_d, ((PyObject *)__pyx_codeobj__10));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 11, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_init_fftw, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 11, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
/* … */
  __pyx_codeobj__10 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(0, 0, 0, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_pyrost_bin_beam_calc_pyx, __pyx_n_s_init_fftw, 11, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__10)) __PYX_ERR(0, 11, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">012</span>:     <span class="n">fftw_init_threads</span><span class="p">()</span></pre>
<pre class='cython code score-0 '>  fftw_init_threads();
</pre><pre class="cython line score-0">&#xA0;<span class="">013</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">014</span>:     <span class="k">if</span> <span class="n">Py_AtExit</span><span class="p">(</span><span class="n">fftw_cleanup_threads</span><span class="p">)</span> <span class="o">!=</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((Py_AtExit(fftw_cleanup_threads) != 0) != 0);
  if (unlikely(__pyx_t_1)) {
/* … */
  }
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">015</span>:         <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s">&#39;Failed to register the fftw library shutdown callback&#39;</span><span class="p">)</span></pre>
<pre class='cython code score-10 '>    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_ImportError, __pyx_tuple_, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 15, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_2, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='error_goto'>__PYX_ERR(0, 15, __pyx_L1_error)</span>
/* … */
  __pyx_tuple_ = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_u_Failed_to_register_the_fftw_libr);<span class='error_goto'> if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 15, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple_);
</pre><pre class="cython line score-0">&#xA0;<span class="">016</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">017</span>: <span class="n">init_fftw</span><span class="p">()</span></pre>
<pre class='cython code score-6 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_init_fftw);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 17, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 17, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">018</span>: </pre>
<pre class="cython line score-58" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">019</span>: <span class="k">def</span> <span class="nf">next_fast_len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">npy_intp</span> <span class="n">target</span><span class="p">,</span> <span class="nb">str</span> <span class="n">backend</span><span class="o">=</span><span class="s">&#39;fftw&#39;</span><span class="p">):</span></pre>
<pre class='cython code score-58 '>/* Python wrapper */
static PyObject *__pyx_pw_6pyrost_3bin_9beam_calc_3next_fast_len(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6pyrost_3bin_9beam_calc_2next_fast_len[] = "next_fast_len(npy_intp target, unicode backend=u'fftw')\nFind the next fast size of input data to fft, for zero-padding, etc.\n    FFT algorithms gain their speed by a recursive divide and conquer strategy.\n    This relies on efficient functions for small prime factors of the input length.\n    Thus, the transforms are fastest when using composites of the prime factors handled\n    by the fft implementation. If there are efficient functions for all radices &lt;= n,\n    then the result will be a number x &gt;= target with only prime factors &lt; n. (Also\n    known as n-smooth numbers)\n\n    Parameters\n    ----------\n    target : int\n        Length to start searching from. Must be a positive integer.\n    backend : {'fftw', 'numpy'}, optional\n        Find n-smooth number for the FFT implementation from the specified\n        library.\n\n    Returns\n    -------\n    n : int\n        The smallest fast length greater than or equal to `target`.\n    ";
static PyMethodDef __pyx_mdef_6pyrost_3bin_9beam_calc_3next_fast_len = {"next_fast_len", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6pyrost_3bin_9beam_calc_3next_fast_len, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6pyrost_3bin_9beam_calc_2next_fast_len};
static PyObject *__pyx_pw_6pyrost_3bin_9beam_calc_3next_fast_len(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  npy_intp __pyx_v_target;
  PyObject *__pyx_v_backend = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("next_fast_len (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_target,&amp;__pyx_n_s_backend,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject*)((PyObject*)__pyx_n_u_fftw));
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_target)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_backend);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "next_fast_len") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 19, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_target = <span class='pyx_c_api'>__Pyx_PyInt_As_Py_intptr_t</span>(values[0]); if (unlikely((__pyx_v_target == ((npy_intp)-1)) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 19, __pyx_L3_error)</span>
    __pyx_v_backend = ((PyObject*)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("next_fast_len", 0, 1, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 19, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.next_fast_len", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_backend), (&amp;PyUnicode_Type), 1, "backend", 1))) <span class='error_goto'>__PYX_ERR(0, 19, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_6pyrost_3bin_9beam_calc_2next_fast_len(__pyx_self, __pyx_v_target, __pyx_v_backend);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6pyrost_3bin_9beam_calc_2next_fast_len(CYTHON_UNUSED PyObject *__pyx_self, npy_intp __pyx_v_target, PyObject *__pyx_v_backend) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("next_fast_len", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.next_fast_len", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__11 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_n_s_target, __pyx_n_s_backend);<span class='error_goto'> if (unlikely(!__pyx_tuple__11)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__11);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__11);
  __pyx_codeobj__12 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__11, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_pyrost_bin_beam_calc_pyx, __pyx_n_s_next_fast_len, 19, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__12)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
/* … */
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_6pyrost_3bin_9beam_calc_3next_fast_len, 0, __pyx_n_s_next_fast_len, NULL, __pyx_n_s_pyrost_bin_beam_calc, __pyx_d, ((PyObject *)__pyx_codeobj__12));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsTuple</span>(__pyx_t_3, __pyx_tuple__13);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_next_fast_len, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_tuple__13 = <span class='py_c_api'>PyTuple_Pack</span>(1, ((PyObject*)__pyx_n_u_fftw));<span class='error_goto'> if (unlikely(!__pyx_tuple__13)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__13);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__13);
</pre><pre class="cython line score-0">&#xA0;<span class="">020</span>:     <span class="s">r&quot;&quot;&quot;Find the next fast size of input data to fft, for zero-padding, etc.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">021</span>: <span class="s">    FFT algorithms gain their speed by a recursive divide and conquer strategy.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">022</span>: <span class="s">    This relies on efficient functions for small prime factors of the input length.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">023</span>: <span class="s">    Thus, the transforms are fastest when using composites of the prime factors handled</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">024</span>: <span class="s">    by the fft implementation. If there are efficient functions for all radices &lt;= n,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">025</span>: <span class="s">    then the result will be a number x &gt;= target with only prime factors &lt; n. (Also</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">026</span>: <span class="s">    known as n-smooth numbers)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">027</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">028</span>: <span class="s">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">029</span>: <span class="s">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">030</span>: <span class="s">    target : int</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">031</span>: <span class="s">        Length to start searching from. Must be a positive integer.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">032</span>: <span class="s">    backend : {&#39;fftw&#39;, &#39;numpy&#39;}, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">033</span>: <span class="s">        Find n-smooth number for the FFT implementation from the specified</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">034</span>: <span class="s">        library.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">035</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">036</span>: <span class="s">    Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">037</span>: <span class="s">    -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">038</span>: <span class="s">    n : int</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">039</span>: <span class="s">        The smallest fast length greater than or equal to `target`.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">040</span>: <span class="s">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">041</span>:     <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s">&#39;fftw&#39;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_1 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_backend, __pyx_n_u_fftw, Py_EQ)); if (unlikely(__pyx_t_1 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 41, __pyx_L1_error)</span>
  __pyx_t_2 = (__pyx_t_1 != 0);
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">042</span>:         <span class="k">return</span> <span class="n">next_fast_len_fftw</span><span class="p">(</span><span class="n">target</span><span class="p">)</span></pre>
<pre class='cython code score-3 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_unsigned_long</span>(next_fast_len_fftw(__pyx_v_target));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 42, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">043</span>:     <span class="k">elif</span> <span class="n">backend</span> <span class="o">==</span> <span class="s">&#39;numpy&#39;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_2 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_backend, __pyx_n_u_numpy, Py_EQ)); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 43, __pyx_L1_error)</span>
  __pyx_t_1 = (__pyx_t_2 != 0);
  if (likely(__pyx_t_1)) {
/* … */
  }
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">044</span>:         <span class="k">return</span> <span class="n">good_size</span><span class="p">(</span><span class="n">target</span><span class="p">)</span></pre>
<pre class='cython code score-3 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_unsigned_long</span>(good_size(__pyx_v_target));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 44, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">045</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">046</span>:         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;{:s} is invalid backend&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backend</span><span class="p">))</span></pre>
<pre class='cython code score-22 '>  /*else*/ {
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_kp_u_s_is_invalid_backend, __pyx_n_s_format);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 46, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
      __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
      if (likely(__pyx_t_5)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
      }
    }
    __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_v_backend) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_v_backend);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 46, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_ValueError, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 46, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_4, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='error_goto'>__PYX_ERR(0, 46, __pyx_L1_error)</span>
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">047</span>: </pre>
<pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">048</span>: <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">extend_mode_to_code</span><span class="p">(</span><span class="nb">str</span> <span class="n">mode</span><span class="p">)</span> <span class="k">except</span> <span class="o">-</span><span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-3 '>static int __pyx_f_6pyrost_3bin_9beam_calc_extend_mode_to_code(PyObject *__pyx_v_mode) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("extend_mode_to_code", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.extend_mode_to_code", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">049</span>:     <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;constant&#39;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_1 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_mode, __pyx_n_u_constant, Py_EQ)); if (unlikely(__pyx_t_1 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 49, __pyx_L1_error)</span>
  __pyx_t_2 = (__pyx_t_1 != 0);
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">050</span>:         <span class="k">return</span> <span class="n">EXTEND_CONSTANT</span></pre>
<pre class='cython code score-0 '>    __pyx_r = __pyx_e_6pyrost_3bin_9beam_calc_EXTEND_CONSTANT;
    goto __pyx_L0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">051</span>:     <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;nearest&#39;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_2 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_mode, __pyx_n_u_nearest, Py_EQ)); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 51, __pyx_L1_error)</span>
  __pyx_t_1 = (__pyx_t_2 != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">052</span>:         <span class="k">return</span> <span class="n">EXTEND_NEAREST</span></pre>
<pre class='cython code score-0 '>    __pyx_r = __pyx_e_6pyrost_3bin_9beam_calc_EXTEND_NEAREST;
    goto __pyx_L0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">053</span>:     <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;mirror&#39;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_1 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_mode, __pyx_n_u_mirror, Py_EQ)); if (unlikely(__pyx_t_1 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 53, __pyx_L1_error)</span>
  __pyx_t_2 = (__pyx_t_1 != 0);
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">054</span>:         <span class="k">return</span> <span class="n">EXTEND_MIRROR</span></pre>
<pre class='cython code score-0 '>    __pyx_r = __pyx_e_6pyrost_3bin_9beam_calc_EXTEND_MIRROR;
    goto __pyx_L0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">055</span>:     <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;reflect&#39;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_2 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_mode, __pyx_n_u_reflect, Py_EQ)); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 55, __pyx_L1_error)</span>
  __pyx_t_1 = (__pyx_t_2 != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">056</span>:         <span class="k">return</span> <span class="n">EXTEND_REFLECT</span></pre>
<pre class='cython code score-0 '>    __pyx_r = __pyx_e_6pyrost_3bin_9beam_calc_EXTEND_REFLECT;
    goto __pyx_L0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">057</span>:     <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;wrap&#39;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_1 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_mode, __pyx_n_u_wrap, Py_EQ)); if (unlikely(__pyx_t_1 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 57, __pyx_L1_error)</span>
  __pyx_t_2 = (__pyx_t_1 != 0);
  if (likely(__pyx_t_2)) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">058</span>:         <span class="k">return</span> <span class="n">EXTEND_WRAP</span></pre>
<pre class='cython code score-0 '>    __pyx_r = __pyx_e_6pyrost_3bin_9beam_calc_EXTEND_WRAP;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">059</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">060</span>:         <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;boundary mode not supported&#39;</span><span class="p">)</span></pre>
<pre class='cython code score-10 '>  /*else*/ {
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_RuntimeError, __pyx_tuple__2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 60, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='error_goto'>__PYX_ERR(0, 60, __pyx_L1_error)</span>
  }
/* … */
  __pyx_tuple__2 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_u_boundary_mode_not_supported);<span class='error_goto'> if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 60, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__2);
</pre><pre class="cython line score-0">&#xA0;<span class="">061</span>: </pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">062</span>: <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span> <span class="nf">number_to_array</span><span class="p">(</span><span class="nb">object</span> <span class="n">num</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">npy_intp</span> <span class="n">rank</span><span class="p">,</span> <span class="nb">int</span> <span class="n">type_num</span><span class="p">):</span></pre>
<pre class='cython code score-5 '>static PyArrayObject *__pyx_f_6pyrost_3bin_9beam_calc_number_to_array(PyObject *__pyx_v_num, npy_intp __pyx_v_rank, int __pyx_v_type_num) {
  npy_intp *__pyx_v_dims;
  PyArrayObject *__pyx_v_arr = 0;
  int __pyx_v_i;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("number_to_array", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.number_to_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_arr);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">063</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> *<span class="nf">dims</span> <span class="o">=</span> <span class="p">[</span><span class="n">rank</span><span class="p">,]</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1[0] = __pyx_v_rank;
  __pyx_v_dims = __pyx_t_1;
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">064</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span> <span class="nf">arr</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">np.ndarray</span><span class="p">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_SimpleNew</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">type_num</span><span class="p">)</span></pre>
<pre class='cython code score-7 '>  __pyx_t_2 = <span class='py_c_api'>PyArray_SimpleNew</span>(1, __pyx_v_dims, __pyx_v_type_num);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 64, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = __pyx_t_2;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_arr = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">065</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">066</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rank</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_4 = __pyx_v_rank;
  __pyx_t_5 = __pyx_t_4;
  for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_5; __pyx_t_6+=1) {
    __pyx_v_i = __pyx_t_6;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">067</span>:         <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span></pre>
<pre class='cython code score-2 '>    if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_arr), __pyx_v_i, __pyx_v_num, int, 1, __Pyx_PyInt_From_int, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 67, __pyx_L1_error)</span>
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">068</span>:     <span class="k">return</span> <span class="n">arr</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_arr));
  __pyx_r = __pyx_v_arr;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">069</span>: </pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">070</span>: <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span> <span class="nf">normalize_sequence</span><span class="p">(</span><span class="nb">object</span> <span class="n">inp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">npy_intp</span> <span class="n">rank</span><span class="p">,</span> <span class="nb">int</span> <span class="n">type_num</span><span class="p">):</span></pre>
<pre class='cython code score-5 '>static PyArrayObject *__pyx_f_6pyrost_3bin_9beam_calc_normalize_sequence(PyObject *__pyx_v_inp, npy_intp __pyx_v_rank, int __pyx_v_type_num) {
  PyArrayObject *__pyx_v_arr = 0;
  int __pyx_v_tn;
  npy_intp __pyx_v_size;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("normalize_sequence", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.normalize_sequence", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_arr);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">071</span>:     <span class="s">r&quot;&quot;&quot;If input is a scalar, create a sequence of length equal to the</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">072</span>: <span class="s">    rank by duplicating the input. If input is a sequence,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">073</span>: <span class="s">    check if its length is equal to the length of array.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">074</span>: <span class="s">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">075</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span> <span class="nf">arr</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">076</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">tn</span></pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">077</span>:     <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_IsAnyScalar</span><span class="p">(</span><span class="n">inp</span><span class="p">):</span></pre>
<pre class='cython code score-5 '>  __pyx_t_1 = (<span class='py_c_api'>PyArray_IsAnyScalar</span>(__pyx_v_inp) != 0);
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">078</span>:         <span class="n">arr</span> <span class="o">=</span> <span class="n">number_to_array</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">type_num</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_2 = ((PyObject *)__pyx_f_6pyrost_3bin_9beam_calc_number_to_array(__pyx_v_inp, __pyx_v_rank, __pyx_v_type_num));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 78, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_v_arr = ((PyArrayObject *)__pyx_t_2);
    __pyx_t_2 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">079</span>:     <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_Check</span><span class="p">(</span><span class="n">inp</span><span class="p">):</span></pre>
<pre class='cython code score-5 '>  __pyx_t_1 = (<span class='py_c_api'>PyArray_Check</span>(__pyx_v_inp) != 0);
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">080</span>:         <span class="n">arr</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">np.ndarray</span><span class="p">&gt;</span><span class="n">inp</span></pre>
<pre class='cython code score-1 '>    __pyx_t_2 = __pyx_v_inp;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    __pyx_v_arr = ((PyArrayObject *)__pyx_t_2);
    __pyx_t_2 = 0;
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">081</span>:         <span class="n">tn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_TYPE</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>    __pyx_v_tn = <span class='py_macro_api'>PyArray_TYPE</span>(__pyx_v_arr);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">082</span>:         <span class="k">if</span> <span class="n">tn</span> <span class="o">!=</span> <span class="n">type_num</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((__pyx_v_tn != __pyx_v_type_num) != 0);
    if (__pyx_t_1) {
/* … */
    }
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">083</span>:             <span class="n">arr</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">np.ndarray</span><span class="p">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_Cast</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">type_num</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>      __pyx_t_2 = <span class='py_c_api'>PyArray_Cast</span>(__pyx_v_arr, __pyx_v_type_num);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 83, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_3 = __pyx_t_2;
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_arr, ((PyArrayObject *)__pyx_t_3));
      __pyx_t_3 = 0;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">084</span>:     <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span></pre>
<pre class='cython code score-10 '>  __pyx_t_4 = <span class='py_c_api'>PyList_Check</span>(__pyx_v_inp); 
  __pyx_t_5 = (__pyx_t_4 != 0);
  if (!__pyx_t_5) {
  } else {
    __pyx_t_1 = __pyx_t_5;
    goto __pyx_L5_bool_binop_done;
  }
  __pyx_t_5 = <span class='py_c_api'>PyTuple_Check</span>(__pyx_v_inp); 
  __pyx_t_4 = (__pyx_t_5 != 0);
  __pyx_t_1 = __pyx_t_4;
  __pyx_L5_bool_binop_done:;
  __pyx_t_4 = (__pyx_t_1 != 0);
  if (likely(__pyx_t_4)) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">085</span>:         <span class="n">arr</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">np.ndarray</span><span class="p">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_FROM_OTF</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">type_num</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_ARRAY_C_CONTIGUOUS</span><span class="p">)</span></pre>
<pre class='cython code score-3 '>    __pyx_t_3 = <span class='py_macro_api'>PyArray_FROM_OTF</span>(__pyx_v_inp, __pyx_v_type_num, NPY_ARRAY_C_CONTIGUOUS);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 85, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_2 = __pyx_t_3;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_arr = ((PyArrayObject *)__pyx_t_2);
    __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">086</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">087</span>:         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Wrong sequence argument type&quot;</span><span class="p">)</span></pre>
<pre class='cython code score-10 '>  /*else*/ {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_ValueError, __pyx_tuple__3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 87, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_2, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='error_goto'>__PYX_ERR(0, 87, __pyx_L1_error)</span>
  }
  __pyx_L3:;
/* … */
  __pyx_tuple__3 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_u_Wrong_sequence_argument_type);<span class='error_goto'> if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 87, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__3);
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">088</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> <span class="nf">size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_SIZE</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v_size = <span class='py_macro_api'>PyArray_SIZE</span>(__pyx_v_arr);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">089</span>:     <span class="k">if</span> <span class="n">size</span> <span class="o">!=</span> <span class="n">rank</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_4 = ((__pyx_v_size != __pyx_v_rank) != 0);
  if (unlikely(__pyx_t_4)) {
/* … */
  }
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">090</span>:         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Sequence argument must have length equal to input rank&quot;</span><span class="p">)</span></pre>
<pre class='cython code score-10 '>    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_ValueError, __pyx_tuple__4, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 90, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_2, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='error_goto'>__PYX_ERR(0, 90, __pyx_L1_error)</span>
/* … */
  __pyx_tuple__4 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_u_Sequence_argument_must_have_leng);<span class='error_goto'> if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 90, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__4);
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">091</span>:     <span class="k">return</span> <span class="n">arr</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_arr));
  __pyx_r = __pyx_v_arr;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">092</span>: </pre>
<pre class="cython line score-115" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">093</span>: <span class="k">def</span> <span class="nf">gaussian_kernel</span><span class="p">(</span><span class="n">sigma</span><span class="p">:</span> <span class="n">double</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">uint</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span> <span class="n">truncate</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="o">=</span><span class="mf">4.</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span></pre>
<pre class='cython code score-115 '>/* Python wrapper */
static PyArrayObject *__pyx_pw_6pyrost_3bin_9beam_calc_5gaussian_kernel(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6pyrost_3bin_9beam_calc_4gaussian_kernel[] = "gaussian_kernel(double sigma: double, unsigned int order: cython.uint = 0, double truncate: cython.double = 4.) -&gt; np.ndarray";
static PyMethodDef __pyx_mdef_6pyrost_3bin_9beam_calc_5gaussian_kernel = {"gaussian_kernel", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6pyrost_3bin_9beam_calc_5gaussian_kernel, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6pyrost_3bin_9beam_calc_4gaussian_kernel};
static PyArrayObject *__pyx_pw_6pyrost_3bin_9beam_calc_5gaussian_kernel(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_sigma;
  unsigned int __pyx_v_order;
  double __pyx_v_truncate;
  PyArrayObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("gaussian_kernel (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_sigma,&amp;__pyx_n_s_order,&amp;__pyx_n_s_truncate,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sigma)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_order);
          if (value) { values[1] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_truncate);
          if (value) { values[2] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gaussian_kernel") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 93, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_sigma = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[0]); if (unlikely((__pyx_v_sigma == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 93, __pyx_L3_error)</span>
    if (values[1]) {
      __pyx_v_order = <span class='pyx_c_api'>__Pyx_PyInt_As_unsigned_int</span>(values[1]); if (unlikely((__pyx_v_order == (unsigned int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 93, __pyx_L3_error)</span>
    } else {
      __pyx_v_order = ((unsigned int)((unsigned int)0));
    }
    if (values[2]) {
      __pyx_v_truncate = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_truncate == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 93, __pyx_L3_error)</span>
    } else {
      __pyx_v_truncate = ((double)((double)4.));
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gaussian_kernel", 0, 1, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 93, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.gaussian_kernel", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6pyrost_3bin_9beam_calc_4gaussian_kernel(__pyx_self, __pyx_v_sigma, __pyx_v_order, __pyx_v_truncate);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyArrayObject *__pyx_pf_6pyrost_3bin_9beam_calc_4gaussian_kernel(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_sigma, unsigned int __pyx_v_order, double __pyx_v_truncate) {
  npy_intp __pyx_v_radius;
  npy_intp *__pyx_v_dims;
  PyArrayObject *__pyx_v_out = 0;
  double *__pyx_v__out;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("gaussian_kernel", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.gaussian_kernel", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_out);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__14 = <span class='py_c_api'>PyTuple_Pack</span>(7, __pyx_n_s_sigma, __pyx_n_s_order, __pyx_n_s_truncate, __pyx_n_s_radius, __pyx_n_s_dims, __pyx_n_s_out, __pyx_n_s_out_2);<span class='error_goto'> if (unlikely(!__pyx_tuple__14)) __PYX_ERR(0, 93, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__14);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__14);
/* … */
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_unsigned_int</span>(((unsigned int)0));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 93, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(((double)4.));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 93, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 93, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_1);
  __pyx_t_3 = 0;
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 93, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_sigma, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 93, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_order, __pyx_kp_u_unsigned_int) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 93, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_truncate, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 93, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_return, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 93, __pyx_L1_error)</span>
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_6pyrost_3bin_9beam_calc_5gaussian_kernel, 0, __pyx_n_s_gaussian_kernel, NULL, __pyx_n_s_pyrost_bin_beam_calc, __pyx_d, ((PyObject *)__pyx_codeobj__15));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 93, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsTuple</span>(__pyx_t_3, __pyx_t_4);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetAnnotationsDict</span>(__pyx_t_3, __pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_gaussian_kernel, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 93, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__15 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(3, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__14, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_pyrost_bin_beam_calc_pyx, __pyx_n_s_gaussian_kernel, 93, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__15)) __PYX_ERR(0, 93, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">094</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> <span class="nf">radius</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">np</span><span class="o">.</span><span class="n">npy_intp</span><span class="o">&gt;</span><span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">truncate</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_radius = ((npy_intp)(__pyx_v_sigma * __pyx_v_truncate));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">095</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> *<span class="nf">dims</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">+</span> <span class="mf">1</span><span class="p">,]</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1[0] = ((2 * __pyx_v_radius) + 1);
  __pyx_v_dims = __pyx_t_1;
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">096</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span> <span class="nf">out</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">np.ndarray</span><span class="p">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_SimpleNew</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_FLOAT64</span><span class="p">)</span></pre>
<pre class='cython code score-7 '>  __pyx_t_2 = <span class='py_c_api'>PyArray_SimpleNew</span>(1, __pyx_v_dims, NPY_FLOAT64);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 96, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = __pyx_t_2;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_out = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">097</span>:     <span class="k">cdef</span> <span class="kt">double</span> *<span class="nf">_out</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">out</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__out = ((double *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_out));
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">098</span>:     <span class="k">with</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class='cython code score-4 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L5;
        }
        __pyx_L5:;
      }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">099</span>:         <span class="n">gauss_kernel1d</span><span class="p">(</span><span class="n">_out</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">dims</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span></pre>
<pre class='cython code score-0 '>        gauss_kernel1d(__pyx_v__out, __pyx_v_sigma, __pyx_v_order, (__pyx_v_dims[0]));
      }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">100</span>:     <span class="k">return</span> <span class="n">out</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_out));
  __pyx_r = __pyx_v_out;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">101</span>: </pre>
<pre class="cython line score-173" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">102</span>: <span class="k">def</span> <span class="nf">gaussian_filter</span><span class="p">(</span><span class="n">inp</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="nb">object</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s">&#39;reflect&#39;</span><span class="p">,</span></pre>
<pre class='cython code score-173 '>/* Python wrapper */
static PyArrayObject *__pyx_pw_6pyrost_3bin_9beam_calc_7gaussian_filter(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6pyrost_3bin_9beam_calc_6gaussian_filter[] = "gaussian_filter(ndarray inp: np.ndarray, sigma: object, order: object = 0, unicode mode: str = u'reflect', double cval: cython.double = 0., double truncate: cython.double = 4., unicode backend: str = u'fftw', unsigned int num_threads: cython.uint = 1) -&gt; np.ndarray\nMultidimensional Gaussian filter. The multidimensional filter is implemented as\n    a sequence of 1-D FFT convolutions.\n\n    Parameters\n    ----------\n    inp : np.ndarray\n        The input array.\n    sigma : float or list of floats\n        Standard deviation for Gaussian kernel. The standard deviations of the Gaussian\n        filter are given for each axis as a sequence, or as a single number, in which case\n        it is equal for all axes.\n    order : int or list of ints, optional\n        The order of the filter along each axis is given as a sequence of integers, or as\n        a single number. An order of 0 corresponds to convolution with a Gaussian kernel.\n        A positive order corresponds to convolution with that derivative of a Gaussian.\n    mode : {'constant', 'nearest', 'mirror', 'wrap'}, optional\n        The mode parameter determines how the input array is extended when the filter\n        overlaps a border. Default value is 'reflect'. The valid values and their behavior\n        is as follows:\n\n        * 'constant', (k k k k | a b c d | k k k k) : The input is extended by filling all\n          values beyond the edge with the same constant value, defined by the `cval`\n          parameter.\n        * 'nearest', (a a a a | a b c d | d d d d) : The input is extended by replicating\n          the last pixel.\n        * 'mirror', (c d c b | a b c d | c b a b) : The input is extended by reflecting\n          about the center of the last pixel. This mode is also sometimes referred to as\n          whole-sample symmetric.\n        * 'reflect', (d c b a | a b c d | d c b a) : The input is extended by reflecting\n          about the edge of the last pixel. This mode is also sometimes"" referred to as\n          half-sample symmetric.\n    cval : float, optional\n        Value to fill past edges of input if mode is \342\200\230constant\342\200\231. Default is 0.0.\n    truncate : float, optional\n        Truncate the filter at this many standard deviations. Default is 4.0.\n    backend : {'fftw', 'numpy'}, optional\n        Choose backend library for the FFT implementation.\n    num_threads : int, optional\n        Number of threads.\n    \n    Returns\n    -------\n    out : np.ndarray\n        Returned array of same shape as `input`.\n    ";
static PyMethodDef __pyx_mdef_6pyrost_3bin_9beam_calc_7gaussian_filter = {"gaussian_filter", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6pyrost_3bin_9beam_calc_7gaussian_filter, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6pyrost_3bin_9beam_calc_6gaussian_filter};
static PyArrayObject *__pyx_pw_6pyrost_3bin_9beam_calc_7gaussian_filter(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_inp = 0;
  PyObject *__pyx_v_sigma = 0;
  PyObject *__pyx_v_order = 0;
  PyObject *__pyx_v_mode = 0;
  double __pyx_v_cval;
  double __pyx_v_truncate;
  PyObject *__pyx_v_backend = 0;
  unsigned int __pyx_v_num_threads;
  PyArrayObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("gaussian_filter (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_inp,&amp;__pyx_n_s_sigma,&amp;__pyx_n_s_order,&amp;__pyx_n_s_mode,&amp;__pyx_n_s_cval,&amp;__pyx_n_s_truncate,&amp;__pyx_n_s_backend,&amp;__pyx_n_s_num_threads,0};
    PyObject* values[8] = {0,0,0,0,0,0,0,0};
    values[2] = ((PyObject *)((PyObject *)__pyx_int_0));
    values[3] = ((PyObject*)((PyObject*)__pyx_n_u_reflect));
    values[6] = ((PyObject*)((PyObject*)__pyx_n_u_fftw));
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_inp)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sigma)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gaussian_filter", 0, 2, 8, 1); <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_order);
          if (value) { values[2] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_mode);
          if (value) { values[3] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_cval);
          if (value) { values[4] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_truncate);
          if (value) { values[5] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_backend);
          if (value) { values[6] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_num_threads);
          if (value) { values[7] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gaussian_filter") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_inp = ((PyArrayObject *)values[0]);
    __pyx_v_sigma = values[1];
    __pyx_v_order = values[2];
    __pyx_v_mode = ((PyObject*)values[3]);
    if (values[4]) {
      __pyx_v_cval = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_cval == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 103, __pyx_L3_error)</span>
    } else {
      __pyx_v_cval = ((double)((double)0.));
    }
    if (values[5]) {
      __pyx_v_truncate = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[5]); if (unlikely((__pyx_v_truncate == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 103, __pyx_L3_error)</span>
    } else {
      __pyx_v_truncate = ((double)((double)4.));
    }
    __pyx_v_backend = ((PyObject*)values[6]);
    if (values[7]) {
      __pyx_v_num_threads = <span class='pyx_c_api'>__Pyx_PyInt_As_unsigned_int</span>(values[7]); if (unlikely((__pyx_v_num_threads == (unsigned int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L3_error)</span>
    } else {
      __pyx_v_num_threads = ((unsigned int)((unsigned int)1));
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gaussian_filter", 0, 2, 8, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.gaussian_filter", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_inp), __pyx_ptype_5numpy_ndarray, 1, "inp", 0))) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_mode), (&amp;PyUnicode_Type), 1, "mode", 1))) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_backend), (&amp;PyUnicode_Type), 1, "backend", 1))) <span class='error_goto'>__PYX_ERR(0, 103, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_6pyrost_3bin_9beam_calc_6gaussian_filter(__pyx_self, __pyx_v_inp, __pyx_v_sigma, __pyx_v_order, __pyx_v_mode, __pyx_v_cval, __pyx_v_truncate, __pyx_v_backend, __pyx_v_num_threads);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyArrayObject *__pyx_pf_6pyrost_3bin_9beam_calc_6gaussian_filter(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_inp, PyObject *__pyx_v_sigma, PyObject *__pyx_v_order, PyObject *__pyx_v_mode, double __pyx_v_cval, double __pyx_v_truncate, PyObject *__pyx_v_backend, unsigned int __pyx_v_num_threads) {
  int __pyx_v_ndim;
  PyArrayObject *__pyx_v_sigmas = 0;
  PyArrayObject *__pyx_v_orders = 0;
  npy_intp *__pyx_v_dims;
  PyArrayObject *__pyx_v_out = 0;
  double *__pyx_v__out;
  double *__pyx_v__inp;
  unsigned long *__pyx_v__dims;
  double *__pyx_v__sig;
  unsigned int *__pyx_v__ord;
  int __pyx_v__mode;
  int __pyx_v_fail;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("gaussian_filter", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_inp);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.gaussian_filter", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_sigmas);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_orders);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_out);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_inp);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__16 = <span class='py_c_api'>PyTuple_Pack</span>(20, __pyx_n_s_inp, __pyx_n_s_sigma, __pyx_n_s_order, __pyx_n_s_mode, __pyx_n_s_cval, __pyx_n_s_truncate, __pyx_n_s_backend, __pyx_n_s_num_threads, __pyx_n_s_ndim, __pyx_n_s_sigmas, __pyx_n_s_orders, __pyx_n_s_dims, __pyx_n_s_out, __pyx_n_s_out_2, __pyx_n_s_inp_2, __pyx_n_s_dims_2, __pyx_n_s_sig, __pyx_n_s_ord, __pyx_n_s_mode_2, __pyx_n_s_fail);<span class='error_goto'> if (unlikely(!__pyx_tuple__16)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__16);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__16);
/* … */
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(6);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_int_0));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_int_0));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, ((PyObject *)__pyx_int_0));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject*)__pyx_n_u_reflect));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject*)__pyx_n_u_reflect));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, ((PyObject*)__pyx_n_u_reflect));
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 2, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 3, __pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject*)__pyx_n_u_fftw));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject*)__pyx_n_u_fftw));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 4, ((PyObject*)__pyx_n_u_fftw));
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 5, __pyx_t_4);
  __pyx_t_3 = 0;
  __pyx_t_1 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(9);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_inp, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_sigma, __pyx_n_u_object) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_order, __pyx_n_u_object) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_mode, __pyx_n_u_unicode) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_cval, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_truncate, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_backend, __pyx_n_u_unicode) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_num_threads, __pyx_kp_u_unsigned_int) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_return, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_6pyrost_3bin_9beam_calc_7gaussian_filter, 0, __pyx_n_s_gaussian_filter, NULL, __pyx_n_s_pyrost_bin_beam_calc, __pyx_d, ((PyObject *)__pyx_codeobj__17));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsTuple</span>(__pyx_t_1, __pyx_t_5);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetAnnotationsDict</span>(__pyx_t_1, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_gaussian_filter, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 102, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__17 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(8, 0, 20, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_pyrost_bin_beam_calc_pyx, __pyx_n_s_gaussian_filter, 102, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__17)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">103</span>:                     <span class="n">cval</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">truncate</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s">&#39;fftw&#39;</span><span class="p">,</span></pre>
<pre class='cython code score-10 '>  __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(((double)0.));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 103, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(((double)4.));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 103, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">104</span>:                     <span class="n">num_threads</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">uint</span><span class="o">=</span><span class="mf">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_unsigned_int</span>(((unsigned int)1));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 104, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
</pre><pre class="cython line score-0">&#xA0;<span class="">105</span>:     <span class="s">r&quot;&quot;&quot;Multidimensional Gaussian filter. The multidimensional filter is implemented as</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">106</span>: <span class="s">    a sequence of 1-D FFT convolutions.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">107</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">108</span>: <span class="s">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">109</span>: <span class="s">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">110</span>: <span class="s">    inp : np.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">111</span>: <span class="s">        The input array.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">112</span>: <span class="s">    sigma : float or list of floats</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">113</span>: <span class="s">        Standard deviation for Gaussian kernel. The standard deviations of the Gaussian</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">114</span>: <span class="s">        filter are given for each axis as a sequence, or as a single number, in which case</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">115</span>: <span class="s">        it is equal for all axes.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">116</span>: <span class="s">    order : int or list of ints, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">117</span>: <span class="s">        The order of the filter along each axis is given as a sequence of integers, or as</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">118</span>: <span class="s">        a single number. An order of 0 corresponds to convolution with a Gaussian kernel.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">119</span>: <span class="s">        A positive order corresponds to convolution with that derivative of a Gaussian.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">120</span>: <span class="s">    mode : {&#39;constant&#39;, &#39;nearest&#39;, &#39;mirror&#39;, &#39;wrap&#39;}, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">121</span>: <span class="s">        The mode parameter determines how the input array is extended when the filter</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">122</span>: <span class="s">        overlaps a border. Default value is &#39;reflect&#39;. The valid values and their behavior</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">123</span>: <span class="s">        is as follows:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">124</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">125</span>: <span class="s">        * &#39;constant&#39;, (k k k k | a b c d | k k k k) : The input is extended by filling all</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">126</span>: <span class="s">          values beyond the edge with the same constant value, defined by the `cval`</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">127</span>: <span class="s">          parameter.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">128</span>: <span class="s">        * &#39;nearest&#39;, (a a a a | a b c d | d d d d) : The input is extended by replicating</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">129</span>: <span class="s">          the last pixel.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">130</span>: <span class="s">        * &#39;mirror&#39;, (c d c b | a b c d | c b a b) : The input is extended by reflecting</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">131</span>: <span class="s">          about the center of the last pixel. This mode is also sometimes referred to as</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">132</span>: <span class="s">          whole-sample symmetric.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">133</span>: <span class="s">        * &#39;reflect&#39;, (d c b a | a b c d | d c b a) : The input is extended by reflecting</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">134</span>: <span class="s">          about the edge of the last pixel. This mode is also sometimes referred to as</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">135</span>: <span class="s">          half-sample symmetric.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">136</span>: <span class="s">    cval : float, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">137</span>: <span class="s">        Value to fill past edges of input if mode is ‘constant’. Default is 0.0.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">138</span>: <span class="s">    truncate : float, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">139</span>: <span class="s">        Truncate the filter at this many standard deviations. Default is 4.0.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">140</span>: <span class="s">    backend : {&#39;fftw&#39;, &#39;numpy&#39;}, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">141</span>: <span class="s">        Choose backend library for the FFT implementation.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">142</span>: <span class="s">    num_threads : int, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">143</span>: <span class="s">        Number of threads.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">144</span>: <span class="s">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">145</span>: <span class="s">    Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">146</span>: <span class="s">    -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">147</span>: <span class="s">    out : np.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">148</span>: <span class="s">        Returned array of same shape as `input`.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">149</span>: <span class="s">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">150</span>:     <span class="n">inp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_GETCONTIGUOUS</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>  __pyx_t_1 = ((PyObject *)<span class='py_macro_api'>PyArray_GETCONTIGUOUS</span>(__pyx_v_inp));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 150, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_inp, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">151</span>:     <span class="n">inp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_Cast</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_FLOAT64</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='py_c_api'>PyArray_Cast</span>(__pyx_v_inp, NPY_FLOAT64);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 151, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 151, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_inp, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">152</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">153</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">ndim</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_v_inp-&gt;nd;
  __pyx_v_ndim = __pyx_t_2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">154</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span> <span class="nf">sigmas</span> <span class="o">=</span> <span class="n">normalize_sequence</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_FLOAT64</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((PyObject *)__pyx_f_6pyrost_3bin_9beam_calc_normalize_sequence(__pyx_v_sigma, __pyx_v_ndim, NPY_FLOAT64));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 154, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_sigmas = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">155</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span> <span class="nf">orders</span> <span class="o">=</span> <span class="n">normalize_sequence</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_UINT32</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((PyObject *)__pyx_f_6pyrost_3bin_9beam_calc_normalize_sequence(__pyx_v_order, __pyx_v_ndim, NPY_UINT32));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 155, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_orders = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">156</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> *<span class="nf">dims</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">shape</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3 = __pyx_v_inp-&gt;dimensions;
  __pyx_v_dims = __pyx_t_3;
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">157</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span> <span class="nf">out</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">np.ndarray</span><span class="p">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_SimpleNew</span><span class="p">(</span><span class="n">ndim</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_FLOAT64</span><span class="p">)</span></pre>
<pre class='cython code score-7 '>  __pyx_t_1 = <span class='py_c_api'>PyArray_SimpleNew</span>(__pyx_v_ndim, __pyx_v_dims, NPY_FLOAT64);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 157, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = __pyx_t_1;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_out = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">158</span>:     <span class="k">cdef</span> <span class="kt">double</span> *<span class="nf">_out</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">out</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__out = ((double *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_out));
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">159</span>:     <span class="k">cdef</span> <span class="kt">double</span> *<span class="nf">_inp</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__inp = ((double *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_inp));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">160</span>:     <span class="k">cdef</span> <span class="kt">unsigned</span> <span class="kt">long</span> *<span class="nf">_dims</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nb">unsigned</span> <span class="nb">long</span> <span class="o">*&gt;</span><span class="n">dims</span></pre>
<pre class='cython code score-0 '>  __pyx_v__dims = ((unsigned long *)__pyx_v_dims);
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">161</span>:     <span class="k">cdef</span> <span class="kt">double</span> *<span class="nf">_sig</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">sigmas</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__sig = ((double *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_sigmas));
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">162</span>:     <span class="k">cdef</span> <span class="kt">unsigned</span> *<span class="nf">_ord</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nb">unsigned</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">orders</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__ord = ((unsigned int *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_orders));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">163</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">_mode</span> <span class="o">=</span> <span class="n">extend_mode_to_code</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_f_6pyrost_3bin_9beam_calc_extend_mode_to_code(__pyx_v_mode);<span class='error_goto'> if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 163, __pyx_L1_error)</span>
  __pyx_v__mode = __pyx_t_2;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">164</span>:     <span class="k">with</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class='cython code score-6 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L5;
        }
        __pyx_L4_error: {
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L1_error;
        }
        __pyx_L5:;
      }
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">165</span>:         <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s">&#39;fftw&#39;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>        __pyx_t_5 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_backend, __pyx_n_u_fftw, Py_EQ)); if (unlikely(__pyx_t_5 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 165, __pyx_L4_error)</span>
        __pyx_t_6 = (__pyx_t_5 != 0);
        if (__pyx_t_6) {
/* … */
          goto __pyx_L6;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">166</span>:             <span class="n">gauss_filter_fftw</span><span class="p">(</span><span class="n">_out</span><span class="p">,</span> <span class="n">_inp</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">_dims</span><span class="p">,</span> <span class="n">_sig</span><span class="p">,</span> <span class="n">_ord</span><span class="p">,</span> <span class="n">_mode</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span> <span class="n">truncate</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          gauss_filter_fftw(__pyx_v__out, __pyx_v__inp, __pyx_v_ndim, __pyx_v__dims, __pyx_v__sig, __pyx_v__ord, __pyx_v__mode, __pyx_v_cval, __pyx_v_truncate, __pyx_v_num_threads);
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">167</span>:         <span class="k">elif</span> <span class="n">backend</span> <span class="o">==</span> <span class="s">&#39;numpy&#39;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>        __pyx_t_6 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_backend, __pyx_n_u_numpy, Py_EQ)); if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 167, __pyx_L4_error)</span>
        __pyx_t_5 = (__pyx_t_6 != 0);
        if (__pyx_t_5) {
/* … */
          goto __pyx_L6;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">168</span>:             <span class="n">fail</span> <span class="o">=</span> <span class="n">gauss_filter_np</span><span class="p">(</span><span class="n">_out</span><span class="p">,</span> <span class="n">_inp</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">_dims</span><span class="p">,</span> <span class="n">_sig</span><span class="p">,</span> <span class="n">_ord</span><span class="p">,</span> <span class="n">_mode</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span> <span class="n">truncate</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          __pyx_v_fail = gauss_filter_np(__pyx_v__out, __pyx_v__inp, __pyx_v_ndim, __pyx_v__dims, __pyx_v__sig, __pyx_v__ord, __pyx_v__mode, __pyx_v_cval, __pyx_v_truncate);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">169</span>:             <span class="k">if</span> <span class="n">fail</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>          __pyx_t_5 = (__pyx_v_fail != 0);
          if (__pyx_t_5) {
/* … */
          }
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">170</span>:                 <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;NumPy FFT exited with error&#39;</span><span class="p">)</span></pre>
<pre class='cython code score-14 '>            {
                #ifdef WITH_THREAD
                PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                #endif
                /*try:*/ {
                  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_RuntimeError, __pyx_tuple__5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 170, __pyx_L9_error)</span>
                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
                  <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_4, 0, 0, 0);
                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
                  <span class='error_goto'>__PYX_ERR(0, 170, __pyx_L9_error)</span>
                }
                /*finally:*/ {
                  __pyx_L9_error: {
                    #ifdef WITH_THREAD
                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                    #endif
                    goto __pyx_L4_error;
                  }
                }
            }
/* … */
  __pyx_tuple__5 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_u_NumPy_FFT_exited_with_error);<span class='error_goto'> if (unlikely(!__pyx_tuple__5)) __PYX_ERR(0, 170, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__5);
</pre><pre class="cython line score-0">&#xA0;<span class="">171</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-26" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">172</span>:             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;{:s} is invalid backend&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backend</span><span class="p">))</span></pre>
<pre class='cython code score-26 '>        /*else*/ {
          {
              #ifdef WITH_THREAD
              PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
              #endif
              /*try:*/ {
                __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_kp_u_s_is_invalid_backend, __pyx_n_s_format);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L12_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
                __pyx_t_7 = NULL;
                if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
                  __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
                  if (likely(__pyx_t_7)) {
                    PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
                  }
                }
                __pyx_t_4 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_7, __pyx_v_backend) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_v_backend);
                <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
                if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 172, __pyx_L12_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
                __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_ValueError, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L12_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
                <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
                <span class='error_goto'>__PYX_ERR(0, 172, __pyx_L12_error)</span>
              }
              /*finally:*/ {
                __pyx_L12_error: {
                  #ifdef WITH_THREAD
                  <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                  #endif
                  goto __pyx_L4_error;
                }
              }
          }
        }
        __pyx_L6:;
      }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">173</span>:     <span class="k">return</span> <span class="n">out</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_out));
  __pyx_r = __pyx_v_out;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">174</span>: </pre>
<pre class="cython line score-161" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">175</span>: <span class="k">def</span> <span class="nf">gaussian_gradient_magnitude</span><span class="p">(</span><span class="n">inp</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s">&#39;mirror&#39;</span><span class="p">,</span></pre>
<pre class='cython code score-161 '>/* Python wrapper */
static PyArrayObject *__pyx_pw_6pyrost_3bin_9beam_calc_9gaussian_gradient_magnitude(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6pyrost_3bin_9beam_calc_8gaussian_gradient_magnitude[] = "gaussian_gradient_magnitude(ndarray inp: np.ndarray, sigma: object, unicode mode: str = u'mirror', double cval: cython.double = 0., double truncate: cython.double = 4., unicode backend: str = u'fftw', unsigned int num_threads: cython.uint = 1) -&gt; np.ndarray\nMultidimensional gradient magnitude using Gaussian derivatives. The multidimensional\n    filter is implemented as a sequence of 1-D FFT convolutions.\n\n    Parameters\n    ----------\n    input : np.ndarray\n        The input array.\n    sigma : float or list of floats\n        The standard deviations of the Gaussian filter are given for each axis as a sequence,\n        or as a single number, in which case it is equal for all axes.\n    mode : {'constant', 'nearest', 'mirror', 'wrap'}, optional\n        The mode parameter determines how the input array is extended when the filter\n        overlaps a border. Default value is 'reflect'. The valid values and their behavior\n        is as follows:\n\n        * 'constant', (k k k k | a b c d | k k k k) : The input is extended by filling all\n          values beyond the edge with the same constant value, defined by the `cval`\n          parameter.\n        * 'nearest', (a a a a | a b c d | d d d d) : The input is extended by replicating\n          the last pixel.\n        * 'mirror', (c d c b | a b c d | c b a b) : The input is extended by reflecting\n          about the center of the last pixel. This mode is also sometimes referred to as\n          whole-sample symmetric.\n        * 'reflect', (d c b a | a b c d | d c b a) : The input is extended by reflecting\n          about the edge of the last pixel. This mode is also sometimes referred to as\n          half-sample symmetric.\n    cval : float, optional\n        Value to fill past edges of input if mode is \342\200\230constant\342\200\231. Default is 0.0.\n    truncate : float, optional\n        Truncate the filter at this many standard deviations. Default is 4.0.\n    backend : {'fftw', 'numpy'}, optional""\n        Choose backend library for the FFT implementation.\n    num_threads : int, optional\n        Number of threads.\n    ";
static PyMethodDef __pyx_mdef_6pyrost_3bin_9beam_calc_9gaussian_gradient_magnitude = {"gaussian_gradient_magnitude", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6pyrost_3bin_9beam_calc_9gaussian_gradient_magnitude, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6pyrost_3bin_9beam_calc_8gaussian_gradient_magnitude};
static PyArrayObject *__pyx_pw_6pyrost_3bin_9beam_calc_9gaussian_gradient_magnitude(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_inp = 0;
  PyObject *__pyx_v_sigma = 0;
  PyObject *__pyx_v_mode = 0;
  double __pyx_v_cval;
  double __pyx_v_truncate;
  PyObject *__pyx_v_backend = 0;
  unsigned int __pyx_v_num_threads;
  PyArrayObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("gaussian_gradient_magnitude (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_inp,&amp;__pyx_n_s_sigma,&amp;__pyx_n_s_mode,&amp;__pyx_n_s_cval,&amp;__pyx_n_s_truncate,&amp;__pyx_n_s_backend,&amp;__pyx_n_s_num_threads,0};
    PyObject* values[7] = {0,0,0,0,0,0,0};
    values[2] = ((PyObject*)((PyObject*)__pyx_n_u_mirror));
    values[5] = ((PyObject*)((PyObject*)__pyx_n_u_fftw));
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_inp)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sigma)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gaussian_gradient_magnitude", 0, 2, 7, 1); <span class='error_goto'>__PYX_ERR(0, 175, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_mode);
          if (value) { values[2] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_cval);
          if (value) { values[3] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_truncate);
          if (value) { values[4] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_backend);
          if (value) { values[5] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_num_threads);
          if (value) { values[6] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gaussian_gradient_magnitude") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 175, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_inp = ((PyArrayObject *)values[0]);
    __pyx_v_sigma = values[1];
    __pyx_v_mode = ((PyObject*)values[2]);
    if (values[3]) {
      __pyx_v_cval = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_cval == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 176, __pyx_L3_error)</span>
    } else {
      __pyx_v_cval = ((double)((double)0.));
    }
    if (values[4]) {
      __pyx_v_truncate = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_truncate == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 176, __pyx_L3_error)</span>
    } else {
      __pyx_v_truncate = ((double)((double)4.));
    }
    __pyx_v_backend = ((PyObject*)values[5]);
    if (values[6]) {
      __pyx_v_num_threads = <span class='pyx_c_api'>__Pyx_PyInt_As_unsigned_int</span>(values[6]); if (unlikely((__pyx_v_num_threads == (unsigned int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 177, __pyx_L3_error)</span>
    } else {
      __pyx_v_num_threads = ((unsigned int)((unsigned int)1));
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gaussian_gradient_magnitude", 0, 2, 7, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 175, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.gaussian_gradient_magnitude", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_inp), __pyx_ptype_5numpy_ndarray, 1, "inp", 0))) <span class='error_goto'>__PYX_ERR(0, 175, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_mode), (&amp;PyUnicode_Type), 1, "mode", 1))) <span class='error_goto'>__PYX_ERR(0, 175, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_backend), (&amp;PyUnicode_Type), 1, "backend", 1))) <span class='error_goto'>__PYX_ERR(0, 177, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_6pyrost_3bin_9beam_calc_8gaussian_gradient_magnitude(__pyx_self, __pyx_v_inp, __pyx_v_sigma, __pyx_v_mode, __pyx_v_cval, __pyx_v_truncate, __pyx_v_backend, __pyx_v_num_threads);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyArrayObject *__pyx_pf_6pyrost_3bin_9beam_calc_8gaussian_gradient_magnitude(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_inp, PyObject *__pyx_v_sigma, PyObject *__pyx_v_mode, double __pyx_v_cval, double __pyx_v_truncate, PyObject *__pyx_v_backend, unsigned int __pyx_v_num_threads) {
  int __pyx_v_ndim;
  PyArrayObject *__pyx_v_sigmas = 0;
  npy_intp *__pyx_v_dims;
  PyArrayObject *__pyx_v_out = 0;
  double *__pyx_v__out;
  double *__pyx_v__inp;
  unsigned long *__pyx_v__dims;
  double *__pyx_v__sig;
  int __pyx_v__mode;
  int __pyx_v_fail;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("gaussian_gradient_magnitude", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_inp);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.gaussian_gradient_magnitude", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_sigmas);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_out);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_inp);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__18 = <span class='py_c_api'>PyTuple_Pack</span>(17, __pyx_n_s_inp, __pyx_n_s_sigma, __pyx_n_s_mode, __pyx_n_s_cval, __pyx_n_s_truncate, __pyx_n_s_backend, __pyx_n_s_num_threads, __pyx_n_s_ndim, __pyx_n_s_sigmas, __pyx_n_s_dims, __pyx_n_s_out, __pyx_n_s_out_2, __pyx_n_s_inp_2, __pyx_n_s_dims_2, __pyx_n_s_sig, __pyx_n_s_mode_2, __pyx_n_s_fail);<span class='error_goto'> if (unlikely(!__pyx_tuple__18)) __PYX_ERR(0, 175, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__18);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__18);
/* … */
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 175, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject*)__pyx_n_u_mirror));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject*)__pyx_n_u_mirror));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject*)__pyx_n_u_mirror));
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 2, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject*)__pyx_n_u_fftw));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject*)__pyx_n_u_fftw));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 3, ((PyObject*)__pyx_n_u_fftw));
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 4, __pyx_t_5);
  __pyx_t_1 = 0;
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(8);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 175, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_inp, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 175, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_sigma, __pyx_n_u_object) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 175, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_mode, __pyx_n_u_unicode) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 175, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_cval, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 175, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_truncate, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 175, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_backend, __pyx_n_u_unicode) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 175, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_num_threads, __pyx_kp_u_unsigned_int) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 175, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_return, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 175, __pyx_L1_error)</span>
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_6pyrost_3bin_9beam_calc_9gaussian_gradient_magnitude, 0, __pyx_n_s_gaussian_gradient_magnitude, NULL, __pyx_n_s_pyrost_bin_beam_calc, __pyx_d, ((PyObject *)__pyx_codeobj__19));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 175, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsTuple</span>(__pyx_t_4, __pyx_t_3);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetAnnotationsDict</span>(__pyx_t_4, __pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_gaussian_gradient_magnitude, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 175, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_codeobj__19 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(7, 0, 17, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__18, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_pyrost_bin_beam_calc_pyx, __pyx_n_s_gaussian_gradient_magnitude, 175, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__19)) __PYX_ERR(0, 175, __pyx_L1_error)</span>
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">176</span>:                                 <span class="n">cval</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">truncate</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span></pre>
<pre class='cython code score-10 '>  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(((double)0.));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 176, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(((double)4.));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 176, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">177</span>:                                 <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s">&#39;fftw&#39;</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">uint</span><span class="o">=</span><span class="mf">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_unsigned_int</span>(((unsigned int)1));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 177, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
</pre><pre class="cython line score-0">&#xA0;<span class="">178</span>:     <span class="s">r&quot;&quot;&quot;Multidimensional gradient magnitude using Gaussian derivatives. The multidimensional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">179</span>: <span class="s">    filter is implemented as a sequence of 1-D FFT convolutions.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">180</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">181</span>: <span class="s">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">182</span>: <span class="s">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">183</span>: <span class="s">    input : np.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">184</span>: <span class="s">        The input array.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">185</span>: <span class="s">    sigma : float or list of floats</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">186</span>: <span class="s">        The standard deviations of the Gaussian filter are given for each axis as a sequence,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">187</span>: <span class="s">        or as a single number, in which case it is equal for all axes.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">188</span>: <span class="s">    mode : {&#39;constant&#39;, &#39;nearest&#39;, &#39;mirror&#39;, &#39;wrap&#39;}, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">189</span>: <span class="s">        The mode parameter determines how the input array is extended when the filter</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">190</span>: <span class="s">        overlaps a border. Default value is &#39;reflect&#39;. The valid values and their behavior</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">191</span>: <span class="s">        is as follows:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">192</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">193</span>: <span class="s">        * &#39;constant&#39;, (k k k k | a b c d | k k k k) : The input is extended by filling all</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">194</span>: <span class="s">          values beyond the edge with the same constant value, defined by the `cval`</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">195</span>: <span class="s">          parameter.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">196</span>: <span class="s">        * &#39;nearest&#39;, (a a a a | a b c d | d d d d) : The input is extended by replicating</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">197</span>: <span class="s">          the last pixel.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">198</span>: <span class="s">        * &#39;mirror&#39;, (c d c b | a b c d | c b a b) : The input is extended by reflecting</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">199</span>: <span class="s">          about the center of the last pixel. This mode is also sometimes referred to as</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">200</span>: <span class="s">          whole-sample symmetric.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">201</span>: <span class="s">        * &#39;reflect&#39;, (d c b a | a b c d | d c b a) : The input is extended by reflecting</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">202</span>: <span class="s">          about the edge of the last pixel. This mode is also sometimes referred to as</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">203</span>: <span class="s">          half-sample symmetric.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">204</span>: <span class="s">    cval : float, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">205</span>: <span class="s">        Value to fill past edges of input if mode is ‘constant’. Default is 0.0.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">206</span>: <span class="s">    truncate : float, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">207</span>: <span class="s">        Truncate the filter at this many standard deviations. Default is 4.0.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">208</span>: <span class="s">    backend : {&#39;fftw&#39;, &#39;numpy&#39;}, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">209</span>: <span class="s">        Choose backend library for the FFT implementation.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">210</span>: <span class="s">    num_threads : int, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">211</span>: <span class="s">        Number of threads.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">212</span>: <span class="s">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">213</span>:     <span class="n">inp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_GETCONTIGUOUS</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>  __pyx_t_1 = ((PyObject *)<span class='py_macro_api'>PyArray_GETCONTIGUOUS</span>(__pyx_v_inp));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 213, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_inp, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">214</span>:     <span class="n">inp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_Cast</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_FLOAT64</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='py_c_api'>PyArray_Cast</span>(__pyx_v_inp, NPY_FLOAT64);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 214, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 214, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_inp, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">215</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">216</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">ndim</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_v_inp-&gt;nd;
  __pyx_v_ndim = __pyx_t_2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">217</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span> <span class="nf">sigmas</span> <span class="o">=</span> <span class="n">normalize_sequence</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_FLOAT64</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((PyObject *)__pyx_f_6pyrost_3bin_9beam_calc_normalize_sequence(__pyx_v_sigma, __pyx_v_ndim, NPY_FLOAT64));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 217, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_sigmas = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">218</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> *<span class="nf">dims</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">shape</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3 = __pyx_v_inp-&gt;dimensions;
  __pyx_v_dims = __pyx_t_3;
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">219</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span> <span class="nf">out</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">np.ndarray</span><span class="p">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_SimpleNew</span><span class="p">(</span><span class="n">ndim</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_FLOAT64</span><span class="p">)</span></pre>
<pre class='cython code score-7 '>  __pyx_t_1 = <span class='py_c_api'>PyArray_SimpleNew</span>(__pyx_v_ndim, __pyx_v_dims, NPY_FLOAT64);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 219, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = __pyx_t_1;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_out = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">220</span>:     <span class="k">cdef</span> <span class="kt">double</span> *<span class="nf">_out</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">out</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__out = ((double *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_out));
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">221</span>:     <span class="k">cdef</span> <span class="kt">double</span> *<span class="nf">_inp</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__inp = ((double *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_inp));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">222</span>:     <span class="k">cdef</span> <span class="kt">unsigned</span> <span class="kt">long</span> *<span class="nf">_dims</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nb">unsigned</span> <span class="nb">long</span> <span class="o">*&gt;</span><span class="n">dims</span></pre>
<pre class='cython code score-0 '>  __pyx_v__dims = ((unsigned long *)__pyx_v_dims);
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">223</span>:     <span class="k">cdef</span> <span class="kt">double</span> *<span class="nf">_sig</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">sigmas</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__sig = ((double *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_sigmas));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">224</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">_mode</span> <span class="o">=</span> <span class="n">extend_mode_to_code</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_f_6pyrost_3bin_9beam_calc_extend_mode_to_code(__pyx_v_mode);<span class='error_goto'> if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 224, __pyx_L1_error)</span>
  __pyx_v__mode = __pyx_t_2;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">225</span>:     <span class="k">with</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class='cython code score-6 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L5;
        }
        __pyx_L4_error: {
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L1_error;
        }
        __pyx_L5:;
      }
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">226</span>:         <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s">&#39;fftw&#39;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>        __pyx_t_5 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_backend, __pyx_n_u_fftw, Py_EQ)); if (unlikely(__pyx_t_5 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 226, __pyx_L4_error)</span>
        __pyx_t_6 = (__pyx_t_5 != 0);
        if (__pyx_t_6) {
/* … */
          goto __pyx_L6;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">227</span>:             <span class="n">gauss_grad_fftw</span><span class="p">(</span><span class="n">_out</span><span class="p">,</span> <span class="n">_inp</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">_dims</span><span class="p">,</span> <span class="n">_sig</span><span class="p">,</span> <span class="n">_mode</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span> <span class="n">truncate</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          gauss_grad_fftw(__pyx_v__out, __pyx_v__inp, __pyx_v_ndim, __pyx_v__dims, __pyx_v__sig, __pyx_v__mode, __pyx_v_cval, __pyx_v_truncate, __pyx_v_num_threads);
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">228</span>:         <span class="k">elif</span> <span class="n">backend</span> <span class="o">==</span> <span class="s">&#39;numpy&#39;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>        __pyx_t_6 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_backend, __pyx_n_u_numpy, Py_EQ)); if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 228, __pyx_L4_error)</span>
        __pyx_t_5 = (__pyx_t_6 != 0);
        if (__pyx_t_5) {
/* … */
          goto __pyx_L6;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">229</span>:             <span class="n">fail</span> <span class="o">=</span> <span class="n">gauss_grad_np</span><span class="p">(</span><span class="n">_out</span><span class="p">,</span> <span class="n">_inp</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">_dims</span><span class="p">,</span> <span class="n">_sig</span><span class="p">,</span> <span class="n">_mode</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span> <span class="n">truncate</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          __pyx_v_fail = gauss_grad_np(__pyx_v__out, __pyx_v__inp, __pyx_v_ndim, __pyx_v__dims, __pyx_v__sig, __pyx_v__mode, __pyx_v_cval, __pyx_v_truncate);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">230</span>:             <span class="k">if</span> <span class="n">fail</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>          __pyx_t_5 = (__pyx_v_fail != 0);
          if (__pyx_t_5) {
/* … */
          }
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">231</span>:                 <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;NumPy FFT exited with error&#39;</span><span class="p">)</span></pre>
<pre class='cython code score-9 '>            {
                #ifdef WITH_THREAD
                PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                #endif
                /*try:*/ {
                  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_RuntimeError, __pyx_tuple__5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 231, __pyx_L9_error)</span>
                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
                  <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_4, 0, 0, 0);
                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
                  <span class='error_goto'>__PYX_ERR(0, 231, __pyx_L9_error)</span>
                }
                /*finally:*/ {
                  __pyx_L9_error: {
                    #ifdef WITH_THREAD
                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                    #endif
                    goto __pyx_L4_error;
                  }
                }
            }
</pre><pre class="cython line score-0">&#xA0;<span class="">232</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-26" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">233</span>:             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;{:s} is invalid backend&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backend</span><span class="p">))</span></pre>
<pre class='cython code score-26 '>        /*else*/ {
          {
              #ifdef WITH_THREAD
              PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
              #endif
              /*try:*/ {
                __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_kp_u_s_is_invalid_backend, __pyx_n_s_format);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 233, __pyx_L12_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
                __pyx_t_7 = NULL;
                if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
                  __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
                  if (likely(__pyx_t_7)) {
                    PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
                  }
                }
                __pyx_t_4 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_7, __pyx_v_backend) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_v_backend);
                <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
                if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L12_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
                __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_ValueError, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 233, __pyx_L12_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
                <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
                <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L12_error)</span>
              }
              /*finally:*/ {
                __pyx_L12_error: {
                  #ifdef WITH_THREAD
                  <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                  #endif
                  goto __pyx_L4_error;
                }
              }
          }
        }
        __pyx_L6:;
      }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">234</span>:     <span class="k">return</span> <span class="n">out</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_out));
  __pyx_r = __pyx_v_out;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">235</span>: </pre>
<pre class="cython line score-197" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">236</span>: <span class="k">def</span> <span class="nf">rsc_wp</span><span class="p">(</span><span class="n">wft</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">dx0</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="p">,</span></pre>
<pre class='cython code score-197 '>/* Python wrapper */
static PyArrayObject *__pyx_pw_6pyrost_3bin_9beam_calc_11rsc_wp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6pyrost_3bin_9beam_calc_10rsc_wp[] = "rsc_wp(ndarray wft: np.ndarray, double dx0: cython.double, double dx: cython.double, double z: cython.double, double wl: cython.double, int axis: cython.int = -1, unicode backend: str = u'fftw', unsigned int num_threads: cython.uint = 1) -&gt; np.ndarray\nWavefront propagator based on Rayleigh-Sommerfeld convolution\n    method [RSC]_. Propagates a wavefront `wft` by `z` distance\n    downstream. You can choose between 'fftw' and 'numpy' backends for FFT\n    calculations. 'fftw' backend supports multiprocessing.\n\n    Parameters\n    ----------\n    wft : numpy.ndarray\n        Initial wavefront.\n    dx0 : float\n        Sampling interval at the plane upstream [um].\n    dx : float\n        Sampling interval at the plane downstream [um].\n    z : float\n        Propagation distance [um].\n    wl : float\n        Incoming beam's wavelength [um].\n    axis : int, optional\n        Axis of `wft` array along which the calculation is\n        performed.\n    backend : {'fftw', 'numpy'}, optional\n        Choose backend library for the FFT implementation.\n    num_threads: int, optional\n        Number of threads used in calculation. Only 'fftw' backend\n        supports it.\n\n    Returns\n    -------\n    out : numpy.ndarray\n        Propagated wavefront.\n\n    Raises\n    ------\n    RuntimeError\n        If 'numpy' backend exits with eror during the calculation.\n    ValueError\n        If `backend` option is invalid.\n\n    Notes\n    -----\n    The Rayleigh\342\200\223Sommerfeld diffraction integral transform is defined as:\n\n    .. math::\n        u^{\\prime}(x^{\\prime}) = \\frac{z}{j \\sqrt{\\lambda}} \\int_{-\\infty}^{+\\infty}\n        u(x) \\mathrm{exp} \\left[-j k r(x, x^{\\prime}) \\right] dx\n    \n    with\n\n    .. math::\n        r(x, x^{\\prime}) = \\left[ (x - x^{\\prime})^2 + z^2 \\right]^{1 / 2}\n\n    References\n    ----------\n    .. [RSC] V. Nascov and P. C. Logof\304\203tu, \"Fast computation algorithm\n             for the Rayleigh-Sommerfeld"" diffraction formula using\n             a type of scaled convolution,\" Appl. Opt. 48, 4310-4319\n             (2009).\n    ";
static PyMethodDef __pyx_mdef_6pyrost_3bin_9beam_calc_11rsc_wp = {"rsc_wp", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6pyrost_3bin_9beam_calc_11rsc_wp, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6pyrost_3bin_9beam_calc_10rsc_wp};
static PyArrayObject *__pyx_pw_6pyrost_3bin_9beam_calc_11rsc_wp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_wft = 0;
  double __pyx_v_dx0;
  double __pyx_v_dx;
  double __pyx_v_z;
  double __pyx_v_wl;
  int __pyx_v_axis;
  PyObject *__pyx_v_backend = 0;
  unsigned int __pyx_v_num_threads;
  PyArrayObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("rsc_wp (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_wft,&amp;__pyx_n_s_dx0,&amp;__pyx_n_s_dx,&amp;__pyx_n_s_z,&amp;__pyx_n_s_wl,&amp;__pyx_n_s_axis,&amp;__pyx_n_s_backend,&amp;__pyx_n_s_num_threads,0};
    PyObject* values[8] = {0,0,0,0,0,0,0,0};
    values[6] = ((PyObject*)((PyObject*)__pyx_n_u_fftw));
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_wft)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dx0)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("rsc_wp", 0, 5, 8, 1); <span class='error_goto'>__PYX_ERR(0, 236, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dx)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("rsc_wp", 0, 5, 8, 2); <span class='error_goto'>__PYX_ERR(0, 236, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("rsc_wp", 0, 5, 8, 3); <span class='error_goto'>__PYX_ERR(0, 236, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_wl)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("rsc_wp", 0, 5, 8, 4); <span class='error_goto'>__PYX_ERR(0, 236, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_axis);
          if (value) { values[5] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_backend);
          if (value) { values[6] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_num_threads);
          if (value) { values[7] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "rsc_wp") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 236, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_wft = ((PyArrayObject *)values[0]);
    __pyx_v_dx0 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_dx0 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 236, __pyx_L3_error)</span>
    __pyx_v_dx = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_dx == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 236, __pyx_L3_error)</span>
    __pyx_v_z = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_z == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 236, __pyx_L3_error)</span>
    __pyx_v_wl = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_wl == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 237, __pyx_L3_error)</span>
    if (values[5]) {
      __pyx_v_axis = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[5]); if (unlikely((__pyx_v_axis == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 237, __pyx_L3_error)</span>
    } else {
      __pyx_v_axis = ((int)((int)-1));
    }
    __pyx_v_backend = ((PyObject*)values[6]);
    if (values[7]) {
      __pyx_v_num_threads = <span class='pyx_c_api'>__Pyx_PyInt_As_unsigned_int</span>(values[7]); if (unlikely((__pyx_v_num_threads == (unsigned int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 238, __pyx_L3_error)</span>
    } else {
      __pyx_v_num_threads = ((unsigned int)((unsigned int)1));
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("rsc_wp", 0, 5, 8, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 236, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.rsc_wp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_wft), __pyx_ptype_5numpy_ndarray, 1, "wft", 0))) <span class='error_goto'>__PYX_ERR(0, 236, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_backend), (&amp;PyUnicode_Type), 1, "backend", 1))) <span class='error_goto'>__PYX_ERR(0, 237, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_6pyrost_3bin_9beam_calc_10rsc_wp(__pyx_self, __pyx_v_wft, __pyx_v_dx0, __pyx_v_dx, __pyx_v_z, __pyx_v_wl, __pyx_v_axis, __pyx_v_backend, __pyx_v_num_threads);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyArrayObject *__pyx_pf_6pyrost_3bin_9beam_calc_10rsc_wp(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_wft, double __pyx_v_dx0, double __pyx_v_dx, double __pyx_v_z, double __pyx_v_wl, int __pyx_v_axis, PyObject *__pyx_v_backend, unsigned int __pyx_v_num_threads) {
  npy_intp __pyx_v_isize;
  int __pyx_v_ndim;
  npy_intp __pyx_v_npts;
  int __pyx_v_howmany;
  npy_intp *__pyx_v_dims;
  PyArrayObject *__pyx_v_out = 0;
  __pyx_t_double_complex *__pyx_v__out;
  __pyx_t_double_complex *__pyx_v__inp;
  int __pyx_v_fail;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("rsc_wp", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_wft);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.rsc_wp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_out);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_wft);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__20 = <span class='py_c_api'>PyTuple_Pack</span>(17, __pyx_n_s_wft, __pyx_n_s_dx0, __pyx_n_s_dx, __pyx_n_s_z, __pyx_n_s_wl, __pyx_n_s_axis, __pyx_n_s_backend, __pyx_n_s_num_threads, __pyx_n_s_isize, __pyx_n_s_ndim, __pyx_n_s_npts, __pyx_n_s_howmany, __pyx_n_s_dims, __pyx_n_s_out, __pyx_n_s_out_2, __pyx_n_s_inp_2, __pyx_n_s_fail);<span class='error_goto'> if (unlikely(!__pyx_tuple__20)) __PYX_ERR(0, 236, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__20);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__20);
/* … */
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 236, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject*)__pyx_n_u_fftw));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject*)__pyx_n_u_fftw));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, ((PyObject*)__pyx_n_u_fftw));
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 2, __pyx_t_5);
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(9);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 236, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_wft, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 236, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_dx0, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 236, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_dx, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 236, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_z, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 236, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_wl, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 236, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_axis, __pyx_n_u_int) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 236, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_backend, __pyx_n_u_unicode) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 236, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_num_threads, __pyx_kp_u_unsigned_int) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 236, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_return, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 236, __pyx_L1_error)</span>
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_6pyrost_3bin_9beam_calc_11rsc_wp, 0, __pyx_n_s_rsc_wp, NULL, __pyx_n_s_pyrost_bin_beam_calc, __pyx_d, ((PyObject *)__pyx_codeobj__21));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 236, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsTuple</span>(__pyx_t_4, __pyx_t_3);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetAnnotationsDict</span>(__pyx_t_4, __pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_rsc_wp, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 236, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_codeobj__21 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(8, 0, 17, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__20, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_pyrost_bin_beam_calc_pyx, __pyx_n_s_rsc_wp, 236, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__21)) __PYX_ERR(0, 236, __pyx_L1_error)</span>
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">237</span>:            <span class="n">wl</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">int</span><span class="o">=-</span><span class="mf">1</span><span class="p">,</span> <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s">&#39;fftw&#39;</span><span class="p">,</span></pre>
<pre class='cython code score-2 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(((int)-1));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 237, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">238</span>:            <span class="n">num_threads</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">uint</span><span class="o">=</span><span class="mf">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_unsigned_int</span>(((unsigned int)1));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 238, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
</pre><pre class="cython line score-0">&#xA0;<span class="">239</span>:     <span class="s">r&quot;&quot;&quot;Wavefront propagator based on Rayleigh-Sommerfeld convolution</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">240</span>: <span class="s">    method [RSC]_. Propagates a wavefront `wft` by `z` distance</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">241</span>: <span class="s">    downstream. You can choose between &#39;fftw&#39; and &#39;numpy&#39; backends for FFT</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">242</span>: <span class="s">    calculations. &#39;fftw&#39; backend supports multiprocessing.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">243</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">244</span>: <span class="s">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">245</span>: <span class="s">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">246</span>: <span class="s">    wft : numpy.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">247</span>: <span class="s">        Initial wavefront.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">248</span>: <span class="s">    dx0 : float</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">249</span>: <span class="s">        Sampling interval at the plane upstream [um].</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">250</span>: <span class="s">    dx : float</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">251</span>: <span class="s">        Sampling interval at the plane downstream [um].</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">252</span>: <span class="s">    z : float</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">253</span>: <span class="s">        Propagation distance [um].</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">254</span>: <span class="s">    wl : float</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">255</span>: <span class="s">        Incoming beam&#39;s wavelength [um].</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">256</span>: <span class="s">    axis : int, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">257</span>: <span class="s">        Axis of `wft` array along which the calculation is</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">258</span>: <span class="s">        performed.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">259</span>: <span class="s">    backend : {&#39;fftw&#39;, &#39;numpy&#39;}, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">260</span>: <span class="s">        Choose backend library for the FFT implementation.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">261</span>: <span class="s">    num_threads: int, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">262</span>: <span class="s">        Number of threads used in calculation. Only &#39;fftw&#39; backend</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">263</span>: <span class="s">        supports it.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">264</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">265</span>: <span class="s">    Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">266</span>: <span class="s">    -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">267</span>: <span class="s">    out : numpy.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">268</span>: <span class="s">        Propagated wavefront.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">269</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">270</span>: <span class="s">    Raises</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">271</span>: <span class="s">    ------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">272</span>: <span class="s">    RuntimeError</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">273</span>: <span class="s">        If &#39;numpy&#39; backend exits with eror during the calculation.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">274</span>: <span class="s">    ValueError</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">275</span>: <span class="s">        If `backend` option is invalid.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">276</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">277</span>: <span class="s">    Notes</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">278</span>: <span class="s">    -----</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">279</span>: <span class="s">    The Rayleigh–Sommerfeld diffraction integral transform is defined as:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">280</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">281</span>: <span class="s">    .. math::</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">282</span>: <span class="s">        u^{\prime}(x^{\prime}) = \frac{z}{j \sqrt{\lambda}} \int_{-\infty}^{+\infty}</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">283</span>: <span class="s">        u(x) \mathrm{exp} \left[-j k r(x, x^{\prime}) \right] dx</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">284</span>: <span class="s">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">285</span>: <span class="s">    with</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">286</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">287</span>: <span class="s">    .. math::</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">288</span>: <span class="s">        r(x, x^{\prime}) = \left[ (x - x^{\prime})^2 + z^2 \right]^{1 / 2}</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">289</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">290</span>: <span class="s">    References</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">291</span>: <span class="s">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">292</span>: <span class="s">    .. [RSC] V. Nascov and P. C. Logofătu, &quot;Fast computation algorithm</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">293</span>: <span class="s">             for the Rayleigh-Sommerfeld diffraction formula using</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">294</span>: <span class="s">             a type of scaled convolution,&quot; Appl. Opt. 48, 4310-4319</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">295</span>: <span class="s">             (2009).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">296</span>: <span class="s">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">297</span>:     <span class="n">wft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_GETCONTIGUOUS</span><span class="p">(</span><span class="n">wft</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>  __pyx_t_1 = ((PyObject *)<span class='py_macro_api'>PyArray_GETCONTIGUOUS</span>(__pyx_v_wft));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 297, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_wft, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">298</span>:     <span class="n">wft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_Cast</span><span class="p">(</span><span class="n">wft</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_COMPLEX128</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='py_c_api'>PyArray_Cast</span>(__pyx_v_wft, NPY_COMPLEX128);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 298, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 298, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_wft, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">299</span>: </pre>
<pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">300</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> <span class="nf">isize</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_SIZE</span><span class="p">(</span><span class="n">wft</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v_isize = <span class='py_macro_api'>PyArray_SIZE</span>(__pyx_v_wft);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">301</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="n">wft</span><span class="o">.</span><span class="n">ndim</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_v_wft-&gt;nd;
  __pyx_v_ndim = __pyx_t_2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">302</span>:     <span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span> <span class="k">if</span> <span class="n">axis</span> <span class="o">&gt;=</span> <span class="mf">0</span> <span class="k">else</span> <span class="n">ndim</span> <span class="o">+</span> <span class="n">axis</span></pre>
<pre class='cython code score-0 '>  if (((__pyx_v_axis &gt;= 0) != 0)) {
    __pyx_t_2 = __pyx_v_axis;
  } else {
    __pyx_t_2 = (__pyx_v_ndim + __pyx_v_axis);
  }
  __pyx_v_axis = __pyx_t_2;
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">303</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> <span class="nf">npts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_DIM</span><span class="p">(</span><span class="n">wft</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v_npts = <span class='py_macro_api'>PyArray_DIM</span>(__pyx_v_wft, __pyx_v_axis);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">304</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">howmany</span> <span class="o">=</span> <span class="n">isize</span> <span class="o">/</span> <span class="n">npts</span></pre>
<pre class='cython code score-0 '>  __pyx_v_howmany = (__pyx_v_isize / __pyx_v_npts);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">305</span>:     <span class="k">if</span> <span class="n">axis</span> <span class="o">!=</span> <span class="n">ndim</span> <span class="o">-</span> <span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3 = ((__pyx_v_axis != (__pyx_v_ndim - 1)) != 0);
  if (__pyx_t_3) {
/* … */
  }
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">306</span>:         <span class="n">wft</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">np.ndarray</span><span class="p">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_SwapAxes</span><span class="p">(</span><span class="n">wft</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>    __pyx_t_1 = <span class='py_c_api'>PyArray_SwapAxes</span>(__pyx_v_wft, __pyx_v_axis, (__pyx_v_ndim - 1));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 306, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_4 = __pyx_t_1;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_wft, ((PyArrayObject *)__pyx_t_4));
    __pyx_t_4 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">307</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> *<span class="nf">dims</span> <span class="o">=</span> <span class="n">wft</span><span class="o">.</span><span class="n">shape</span></pre>
<pre class='cython code score-0 '>  __pyx_t_5 = __pyx_v_wft-&gt;dimensions;
  __pyx_v_dims = __pyx_t_5;
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">308</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span> <span class="nf">out</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">np.ndarray</span><span class="p">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_SimpleNew</span><span class="p">(</span><span class="n">ndim</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_COMPLEX128</span><span class="p">)</span></pre>
<pre class='cython code score-7 '>  __pyx_t_4 = <span class='py_c_api'>PyArray_SimpleNew</span>(__pyx_v_ndim, __pyx_v_dims, NPY_COMPLEX128);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 308, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_1 = __pyx_t_4;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_out = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">309</span>:     <span class="k">cdef</span> <span class="kt">complex</span> *<span class="nf">_out</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nb">complex</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">out</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__out = ((__pyx_t_double_complex *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_out));
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">310</span>:     <span class="k">cdef</span> <span class="kt">complex</span> *<span class="nf">_inp</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nb">complex</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">wft</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__inp = ((__pyx_t_double_complex *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_wft));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">311</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">fail</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_fail = 0;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">312</span>:     <span class="k">with</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class='cython code score-6 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L6;
        }
        __pyx_L5_error: {
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L1_error;
        }
        __pyx_L6:;
      }
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">313</span>:         <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s">&#39;fftw&#39;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>        __pyx_t_3 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_backend, __pyx_n_u_fftw, Py_EQ)); if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 313, __pyx_L5_error)</span>
        __pyx_t_6 = (__pyx_t_3 != 0);
        if (__pyx_t_6) {
/* … */
          goto __pyx_L7;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">314</span>:             <span class="n">rsc_fftw</span><span class="p">(</span><span class="n">_out</span><span class="p">,</span> <span class="n">_inp</span><span class="p">,</span> <span class="n">howmany</span><span class="p">,</span> <span class="n">npts</span><span class="p">,</span> <span class="n">dx0</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wl</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          rsc_fftw(__pyx_v__out, __pyx_v__inp, __pyx_v_howmany, __pyx_v_npts, __pyx_v_dx0, __pyx_v_dx, __pyx_v_z, __pyx_v_wl, __pyx_v_num_threads);
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">315</span>:         <span class="k">elif</span> <span class="n">backend</span> <span class="o">==</span> <span class="s">&#39;numpy&#39;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>        __pyx_t_6 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_backend, __pyx_n_u_numpy, Py_EQ)); if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 315, __pyx_L5_error)</span>
        __pyx_t_3 = (__pyx_t_6 != 0);
        if (__pyx_t_3) {
/* … */
          goto __pyx_L7;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">316</span>:             <span class="n">fail</span> <span class="o">=</span> <span class="n">rsc_np</span><span class="p">(</span><span class="n">_out</span><span class="p">,</span> <span class="n">_inp</span><span class="p">,</span> <span class="n">howmany</span><span class="p">,</span> <span class="n">npts</span><span class="p">,</span> <span class="n">dx0</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wl</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          __pyx_v_fail = rsc_np(__pyx_v__out, __pyx_v__inp, __pyx_v_howmany, __pyx_v_npts, __pyx_v_dx0, __pyx_v_dx, __pyx_v_z, __pyx_v_wl);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">317</span>:             <span class="k">if</span> <span class="n">fail</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>          __pyx_t_3 = (__pyx_v_fail != 0);
          if (__pyx_t_3) {
/* … */
          }
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">318</span>:                 <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;NumPy FFT exited with error&#39;</span><span class="p">)</span></pre>
<pre class='cython code score-9 '>            {
                #ifdef WITH_THREAD
                PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                #endif
                /*try:*/ {
                  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_RuntimeError, __pyx_tuple__5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 318, __pyx_L10_error)</span>
                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
                  <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
                  <span class='error_goto'>__PYX_ERR(0, 318, __pyx_L10_error)</span>
                }
                /*finally:*/ {
                  __pyx_L10_error: {
                    #ifdef WITH_THREAD
                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                    #endif
                    goto __pyx_L5_error;
                  }
                }
            }
</pre><pre class="cython line score-0">&#xA0;<span class="">319</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-26" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">320</span>:             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;{:s} is invalid backend&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backend</span><span class="p">))</span></pre>
<pre class='cython code score-26 '>        /*else*/ {
          {
              #ifdef WITH_THREAD
              PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
              #endif
              /*try:*/ {
                __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_kp_u_s_is_invalid_backend, __pyx_n_s_format);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 320, __pyx_L13_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
                __pyx_t_7 = NULL;
                if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
                  __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
                  if (likely(__pyx_t_7)) {
                    PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
                  }
                }
                __pyx_t_1 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_7, __pyx_v_backend) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_v_backend);
                <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
                if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 320, __pyx_L13_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
                __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_ValueError, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 320, __pyx_L13_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
                <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_4, 0, 0, 0);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
                <span class='error_goto'>__PYX_ERR(0, 320, __pyx_L13_error)</span>
              }
              /*finally:*/ {
                __pyx_L13_error: {
                  #ifdef WITH_THREAD
                  <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                  #endif
                  goto __pyx_L5_error;
                }
              }
          }
        }
        __pyx_L7:;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">321</span>:     <span class="k">if</span> <span class="n">axis</span> <span class="o">!=</span> <span class="n">ndim</span> <span class="o">-</span> <span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3 = ((__pyx_v_axis != (__pyx_v_ndim - 1)) != 0);
  if (__pyx_t_3) {
/* … */
  }
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">322</span>:         <span class="n">out</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">np.ndarray</span><span class="p">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_SwapAxes</span><span class="p">(</span><span class="n">wft</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>    __pyx_t_4 = <span class='py_c_api'>PyArray_SwapAxes</span>(__pyx_v_wft, __pyx_v_axis, (__pyx_v_ndim - 1));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 322, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_1 = __pyx_t_4;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_out, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">323</span>:     <span class="k">return</span> <span class="n">out</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_out));
  __pyx_r = __pyx_v_out;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">324</span>: </pre>
<pre class="cython line score-197" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">325</span>: <span class="k">def</span> <span class="nf">fraunhofer_wp</span><span class="p">(</span><span class="n">wft</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">dx0</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="p">,</span></pre>
<pre class='cython code score-197 '>/* Python wrapper */
static PyArrayObject *__pyx_pw_6pyrost_3bin_9beam_calc_13fraunhofer_wp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6pyrost_3bin_9beam_calc_12fraunhofer_wp[] = "fraunhofer_wp(ndarray wft: np.ndarray, double dx0: cython.double, double dx: cython.double, double z: cython.double, double wl: cython.double, int axis: cython.int = -1, unicode backend: str = u'fftw', unsigned int num_threads: cython.uint = 1) -&gt; np.ndarray\nFraunhofer diffraction propagator. Propagates a wavefront `wft` by\n    `z` distance downstream. You can choose between 'fftw' and 'numpy'\n    backends for FFT calculations. 'fftw' backend supports multiprocessing.\n\n    Parameters\n    ----------\n    wft : numpy.ndarray\n        Initial wavefront.\n    dx0 : float\n        Sampling interval at the plane upstream [um].\n    dx : float\n        Sampling interval at the plane downstream [um].\n    z : float\n        Propagation distance [um].\n    wl : float\n        Incoming beam's wavelength [um].\n    axis : int, optional\n        Axis of `wft` array along which the calculation is\n        performed.\n    backend : {'fftw', 'numpy'}, optional\n        Choose backend library for the FFT implementation.\n    num_threads: int, optional\n        Number of threads used in calculation. Only 'fftw' backend\n        supports it.\n\n    Returns\n    -------\n    out : numpy.ndarray\n        Propagated wavefront.\n\n    Raises\n    ------\n    RuntimeError\n        If 'numpy' backend exits with eror during the calculation.\n    ValueError\n        If `backend` option is invalid.\n\n    Notes\n    -----\n    The Fraunhofer integral transform is defined as:\n\n    .. math::\n        u^{\\prime}(x^{\\prime}) = \\frac{e^{-j k z}}{j \\sqrt{\\lambda z}}\n        e^{-\\frac{j k}{2 z} x^{\\prime 2}} \\int_{-\\infty}^{+\\infty} u(x)\n        e^{j\\frac{2 \\pi}{\\lambda z} x x^{\\prime}} dx\n    ";
static PyMethodDef __pyx_mdef_6pyrost_3bin_9beam_calc_13fraunhofer_wp = {"fraunhofer_wp", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6pyrost_3bin_9beam_calc_13fraunhofer_wp, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6pyrost_3bin_9beam_calc_12fraunhofer_wp};
static PyArrayObject *__pyx_pw_6pyrost_3bin_9beam_calc_13fraunhofer_wp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_wft = 0;
  double __pyx_v_dx0;
  double __pyx_v_dx;
  double __pyx_v_z;
  double __pyx_v_wl;
  int __pyx_v_axis;
  PyObject *__pyx_v_backend = 0;
  unsigned int __pyx_v_num_threads;
  PyArrayObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("fraunhofer_wp (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_wft,&amp;__pyx_n_s_dx0,&amp;__pyx_n_s_dx,&amp;__pyx_n_s_z,&amp;__pyx_n_s_wl,&amp;__pyx_n_s_axis,&amp;__pyx_n_s_backend,&amp;__pyx_n_s_num_threads,0};
    PyObject* values[8] = {0,0,0,0,0,0,0,0};
    values[6] = ((PyObject*)((PyObject*)__pyx_n_u_fftw));
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_wft)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dx0)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("fraunhofer_wp", 0, 5, 8, 1); <span class='error_goto'>__PYX_ERR(0, 325, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dx)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("fraunhofer_wp", 0, 5, 8, 2); <span class='error_goto'>__PYX_ERR(0, 325, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("fraunhofer_wp", 0, 5, 8, 3); <span class='error_goto'>__PYX_ERR(0, 325, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_wl)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("fraunhofer_wp", 0, 5, 8, 4); <span class='error_goto'>__PYX_ERR(0, 325, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_axis);
          if (value) { values[5] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_backend);
          if (value) { values[6] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_num_threads);
          if (value) { values[7] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "fraunhofer_wp") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 325, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_wft = ((PyArrayObject *)values[0]);
    __pyx_v_dx0 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_dx0 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 325, __pyx_L3_error)</span>
    __pyx_v_dx = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_dx == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 325, __pyx_L3_error)</span>
    __pyx_v_z = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_z == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 326, __pyx_L3_error)</span>
    __pyx_v_wl = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_wl == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 326, __pyx_L3_error)</span>
    if (values[5]) {
      __pyx_v_axis = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[5]); if (unlikely((__pyx_v_axis == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 326, __pyx_L3_error)</span>
    } else {
      __pyx_v_axis = ((int)((int)-1));
    }
    __pyx_v_backend = ((PyObject*)values[6]);
    if (values[7]) {
      __pyx_v_num_threads = <span class='pyx_c_api'>__Pyx_PyInt_As_unsigned_int</span>(values[7]); if (unlikely((__pyx_v_num_threads == (unsigned int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 327, __pyx_L3_error)</span>
    } else {
      __pyx_v_num_threads = ((unsigned int)((unsigned int)1));
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("fraunhofer_wp", 0, 5, 8, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 325, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.fraunhofer_wp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_wft), __pyx_ptype_5numpy_ndarray, 1, "wft", 0))) <span class='error_goto'>__PYX_ERR(0, 325, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_backend), (&amp;PyUnicode_Type), 1, "backend", 1))) <span class='error_goto'>__PYX_ERR(0, 327, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_6pyrost_3bin_9beam_calc_12fraunhofer_wp(__pyx_self, __pyx_v_wft, __pyx_v_dx0, __pyx_v_dx, __pyx_v_z, __pyx_v_wl, __pyx_v_axis, __pyx_v_backend, __pyx_v_num_threads);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyArrayObject *__pyx_pf_6pyrost_3bin_9beam_calc_12fraunhofer_wp(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_wft, double __pyx_v_dx0, double __pyx_v_dx, double __pyx_v_z, double __pyx_v_wl, int __pyx_v_axis, PyObject *__pyx_v_backend, unsigned int __pyx_v_num_threads) {
  npy_intp __pyx_v_isize;
  int __pyx_v_ndim;
  npy_intp __pyx_v_npts;
  int __pyx_v_howmany;
  npy_intp *__pyx_v_dims;
  PyArrayObject *__pyx_v_out = 0;
  __pyx_t_double_complex *__pyx_v__out;
  __pyx_t_double_complex *__pyx_v__inp;
  int __pyx_v_fail;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("fraunhofer_wp", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_wft);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.fraunhofer_wp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_out);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_wft);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__22 = <span class='py_c_api'>PyTuple_Pack</span>(17, __pyx_n_s_wft, __pyx_n_s_dx0, __pyx_n_s_dx, __pyx_n_s_z, __pyx_n_s_wl, __pyx_n_s_axis, __pyx_n_s_backend, __pyx_n_s_num_threads, __pyx_n_s_isize, __pyx_n_s_ndim, __pyx_n_s_npts, __pyx_n_s_howmany, __pyx_n_s_dims, __pyx_n_s_out, __pyx_n_s_out_2, __pyx_n_s_inp_2, __pyx_n_s_fail);<span class='error_goto'> if (unlikely(!__pyx_tuple__22)) __PYX_ERR(0, 325, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__22);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__22);
/* … */
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 325, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject*)__pyx_n_u_fftw));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject*)__pyx_n_u_fftw));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, ((PyObject*)__pyx_n_u_fftw));
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 2, __pyx_t_5);
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(9);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 325, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_wft, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 325, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_dx0, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 325, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_dx, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 325, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_z, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 325, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_wl, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 325, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_axis, __pyx_n_u_int) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 325, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_backend, __pyx_n_u_unicode) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 325, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_num_threads, __pyx_kp_u_unsigned_int) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 325, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_return, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 325, __pyx_L1_error)</span>
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_6pyrost_3bin_9beam_calc_13fraunhofer_wp, 0, __pyx_n_s_fraunhofer_wp, NULL, __pyx_n_s_pyrost_bin_beam_calc, __pyx_d, ((PyObject *)__pyx_codeobj__23));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 325, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsTuple</span>(__pyx_t_4, __pyx_t_3);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetAnnotationsDict</span>(__pyx_t_4, __pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_fraunhofer_wp, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 325, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_codeobj__23 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(8, 0, 17, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__22, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_pyrost_bin_beam_calc_pyx, __pyx_n_s_fraunhofer_wp, 325, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__23)) __PYX_ERR(0, 325, __pyx_L1_error)</span>
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">326</span>:                   <span class="n">z</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="p">,</span> <span class="n">wl</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">int</span><span class="o">=-</span><span class="mf">1</span><span class="p">,</span></pre>
<pre class='cython code score-2 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(((int)-1));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 326, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">327</span>:                   <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s">&#39;fftw&#39;</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">uint</span><span class="o">=</span><span class="mf">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_unsigned_int</span>(((unsigned int)1));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 327, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
</pre><pre class="cython line score-0">&#xA0;<span class="">328</span>:     <span class="s">r&quot;&quot;&quot;Fraunhofer diffraction propagator. Propagates a wavefront `wft` by</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">329</span>: <span class="s">    `z` distance downstream. You can choose between &#39;fftw&#39; and &#39;numpy&#39;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">330</span>: <span class="s">    backends for FFT calculations. &#39;fftw&#39; backend supports multiprocessing.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">331</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">332</span>: <span class="s">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">333</span>: <span class="s">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">334</span>: <span class="s">    wft : numpy.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">335</span>: <span class="s">        Initial wavefront.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">336</span>: <span class="s">    dx0 : float</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">337</span>: <span class="s">        Sampling interval at the plane upstream [um].</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">338</span>: <span class="s">    dx : float</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">339</span>: <span class="s">        Sampling interval at the plane downstream [um].</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">340</span>: <span class="s">    z : float</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">341</span>: <span class="s">        Propagation distance [um].</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">342</span>: <span class="s">    wl : float</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">343</span>: <span class="s">        Incoming beam&#39;s wavelength [um].</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">344</span>: <span class="s">    axis : int, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">345</span>: <span class="s">        Axis of `wft` array along which the calculation is</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">346</span>: <span class="s">        performed.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">347</span>: <span class="s">    backend : {&#39;fftw&#39;, &#39;numpy&#39;}, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">348</span>: <span class="s">        Choose backend library for the FFT implementation.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">349</span>: <span class="s">    num_threads: int, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">350</span>: <span class="s">        Number of threads used in calculation. Only &#39;fftw&#39; backend</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">351</span>: <span class="s">        supports it.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">352</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">353</span>: <span class="s">    Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">354</span>: <span class="s">    -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">355</span>: <span class="s">    out : numpy.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">356</span>: <span class="s">        Propagated wavefront.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">357</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">358</span>: <span class="s">    Raises</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">359</span>: <span class="s">    ------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">360</span>: <span class="s">    RuntimeError</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">361</span>: <span class="s">        If &#39;numpy&#39; backend exits with eror during the calculation.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">362</span>: <span class="s">    ValueError</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">363</span>: <span class="s">        If `backend` option is invalid.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">364</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">365</span>: <span class="s">    Notes</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">366</span>: <span class="s">    -----</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">367</span>: <span class="s">    The Fraunhofer integral transform is defined as:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">368</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">369</span>: <span class="s">    .. math::</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">370</span>: <span class="s">        u^{\prime}(x^{\prime}) = \frac{e^{-j k z}}{j \sqrt{\lambda z}}</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">371</span>: <span class="s">        e^{-\frac{j k}{2 z} x^{\prime 2}} \int_{-\infty}^{+\infty} u(x)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">372</span>: <span class="s">        e^{j\frac{2 \pi}{\lambda z} x x^{\prime}} dx</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">373</span>: <span class="s">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">374</span>:     <span class="n">wft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_GETCONTIGUOUS</span><span class="p">(</span><span class="n">wft</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>  __pyx_t_1 = ((PyObject *)<span class='py_macro_api'>PyArray_GETCONTIGUOUS</span>(__pyx_v_wft));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 374, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_wft, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">375</span>:     <span class="n">wft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_Cast</span><span class="p">(</span><span class="n">wft</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_COMPLEX128</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='py_c_api'>PyArray_Cast</span>(__pyx_v_wft, NPY_COMPLEX128);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 375, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 375, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_wft, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">376</span>: </pre>
<pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">377</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> <span class="nf">isize</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_SIZE</span><span class="p">(</span><span class="n">wft</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v_isize = <span class='py_macro_api'>PyArray_SIZE</span>(__pyx_v_wft);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">378</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="n">wft</span><span class="o">.</span><span class="n">ndim</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_v_wft-&gt;nd;
  __pyx_v_ndim = __pyx_t_2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">379</span>:     <span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span> <span class="k">if</span> <span class="n">axis</span> <span class="o">&gt;=</span> <span class="mf">0</span> <span class="k">else</span> <span class="n">ndim</span> <span class="o">+</span> <span class="n">axis</span></pre>
<pre class='cython code score-0 '>  if (((__pyx_v_axis &gt;= 0) != 0)) {
    __pyx_t_2 = __pyx_v_axis;
  } else {
    __pyx_t_2 = (__pyx_v_ndim + __pyx_v_axis);
  }
  __pyx_v_axis = __pyx_t_2;
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">380</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> <span class="nf">npts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_DIM</span><span class="p">(</span><span class="n">wft</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v_npts = <span class='py_macro_api'>PyArray_DIM</span>(__pyx_v_wft, __pyx_v_axis);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">381</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">howmany</span> <span class="o">=</span> <span class="n">isize</span> <span class="o">/</span> <span class="n">npts</span></pre>
<pre class='cython code score-0 '>  __pyx_v_howmany = (__pyx_v_isize / __pyx_v_npts);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">382</span>:     <span class="k">if</span> <span class="n">axis</span> <span class="o">!=</span> <span class="n">ndim</span> <span class="o">-</span> <span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3 = ((__pyx_v_axis != (__pyx_v_ndim - 1)) != 0);
  if (__pyx_t_3) {
/* … */
  }
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">383</span>:         <span class="n">wft</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">np.ndarray</span><span class="p">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_SwapAxes</span><span class="p">(</span><span class="n">wft</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>    __pyx_t_1 = <span class='py_c_api'>PyArray_SwapAxes</span>(__pyx_v_wft, __pyx_v_axis, (__pyx_v_ndim - 1));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 383, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_4 = __pyx_t_1;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_wft, ((PyArrayObject *)__pyx_t_4));
    __pyx_t_4 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">384</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> *<span class="nf">dims</span> <span class="o">=</span> <span class="n">wft</span><span class="o">.</span><span class="n">shape</span></pre>
<pre class='cython code score-0 '>  __pyx_t_5 = __pyx_v_wft-&gt;dimensions;
  __pyx_v_dims = __pyx_t_5;
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">385</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span> <span class="nf">out</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">np.ndarray</span><span class="p">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_SimpleNew</span><span class="p">(</span><span class="n">ndim</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_COMPLEX128</span><span class="p">)</span></pre>
<pre class='cython code score-7 '>  __pyx_t_4 = <span class='py_c_api'>PyArray_SimpleNew</span>(__pyx_v_ndim, __pyx_v_dims, NPY_COMPLEX128);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 385, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_1 = __pyx_t_4;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_out = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">386</span>:     <span class="k">cdef</span> <span class="kt">complex</span> *<span class="nf">_out</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nb">complex</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">out</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__out = ((__pyx_t_double_complex *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_out));
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">387</span>:     <span class="k">cdef</span> <span class="kt">complex</span> *<span class="nf">_inp</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nb">complex</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">wft</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__inp = ((__pyx_t_double_complex *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_wft));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">388</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">fail</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_fail = 0;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">389</span>:     <span class="k">with</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class='cython code score-6 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L6;
        }
        __pyx_L5_error: {
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L1_error;
        }
        __pyx_L6:;
      }
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">390</span>:         <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s">&#39;fftw&#39;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>        __pyx_t_3 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_backend, __pyx_n_u_fftw, Py_EQ)); if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 390, __pyx_L5_error)</span>
        __pyx_t_6 = (__pyx_t_3 != 0);
        if (__pyx_t_6) {
/* … */
          goto __pyx_L7;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">391</span>:             <span class="n">fraunhofer_fftw</span><span class="p">(</span><span class="n">_out</span><span class="p">,</span> <span class="n">_inp</span><span class="p">,</span> <span class="n">howmany</span><span class="p">,</span> <span class="n">npts</span><span class="p">,</span> <span class="n">dx0</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wl</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          fraunhofer_fftw(__pyx_v__out, __pyx_v__inp, __pyx_v_howmany, __pyx_v_npts, __pyx_v_dx0, __pyx_v_dx, __pyx_v_z, __pyx_v_wl, __pyx_v_num_threads);
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">392</span>:         <span class="k">elif</span> <span class="n">backend</span> <span class="o">==</span> <span class="s">&#39;numpy&#39;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>        __pyx_t_6 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_backend, __pyx_n_u_numpy, Py_EQ)); if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L5_error)</span>
        __pyx_t_3 = (__pyx_t_6 != 0);
        if (__pyx_t_3) {
/* … */
          goto __pyx_L7;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">393</span>:             <span class="n">fail</span> <span class="o">=</span> <span class="n">fraunhofer_np</span><span class="p">(</span><span class="n">_out</span><span class="p">,</span> <span class="n">_inp</span><span class="p">,</span> <span class="n">howmany</span><span class="p">,</span> <span class="n">npts</span><span class="p">,</span> <span class="n">dx0</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wl</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          __pyx_v_fail = fraunhofer_np(__pyx_v__out, __pyx_v__inp, __pyx_v_howmany, __pyx_v_npts, __pyx_v_dx0, __pyx_v_dx, __pyx_v_z, __pyx_v_wl);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">394</span>:             <span class="k">if</span> <span class="n">fail</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>          __pyx_t_3 = (__pyx_v_fail != 0);
          if (__pyx_t_3) {
/* … */
          }
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">395</span>:                 <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;NumPy FFT exited with error&#39;</span><span class="p">)</span></pre>
<pre class='cython code score-9 '>            {
                #ifdef WITH_THREAD
                PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                #endif
                /*try:*/ {
                  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_RuntimeError, __pyx_tuple__5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 395, __pyx_L10_error)</span>
                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
                  <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
                  <span class='error_goto'>__PYX_ERR(0, 395, __pyx_L10_error)</span>
                }
                /*finally:*/ {
                  __pyx_L10_error: {
                    #ifdef WITH_THREAD
                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                    #endif
                    goto __pyx_L5_error;
                  }
                }
            }
</pre><pre class="cython line score-0">&#xA0;<span class="">396</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-26" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">397</span>:             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;{:s} is invalid backend&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backend</span><span class="p">))</span></pre>
<pre class='cython code score-26 '>        /*else*/ {
          {
              #ifdef WITH_THREAD
              PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
              #endif
              /*try:*/ {
                __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_kp_u_s_is_invalid_backend, __pyx_n_s_format);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 397, __pyx_L13_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
                __pyx_t_7 = NULL;
                if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
                  __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
                  if (likely(__pyx_t_7)) {
                    PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
                  }
                }
                __pyx_t_1 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_7, __pyx_v_backend) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_v_backend);
                <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
                if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 397, __pyx_L13_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
                __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_ValueError, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 397, __pyx_L13_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
                <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_4, 0, 0, 0);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
                <span class='error_goto'>__PYX_ERR(0, 397, __pyx_L13_error)</span>
              }
              /*finally:*/ {
                __pyx_L13_error: {
                  #ifdef WITH_THREAD
                  <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                  #endif
                  goto __pyx_L5_error;
                }
              }
          }
        }
        __pyx_L7:;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">398</span>:     <span class="k">if</span> <span class="n">axis</span> <span class="o">!=</span> <span class="n">ndim</span> <span class="o">-</span> <span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3 = ((__pyx_v_axis != (__pyx_v_ndim - 1)) != 0);
  if (__pyx_t_3) {
/* … */
  }
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">399</span>:         <span class="n">out</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">np.ndarray</span><span class="p">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_SwapAxes</span><span class="p">(</span><span class="n">wft</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>    __pyx_t_4 = <span class='py_c_api'>PyArray_SwapAxes</span>(__pyx_v_wft, __pyx_v_axis, (__pyx_v_ndim - 1));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 399, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_1 = __pyx_t_4;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_out, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">400</span>:     <span class="k">return</span> <span class="n">out</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_out));
  __pyx_r = __pyx_v_out;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">401</span>: </pre>
<pre class="cython line score-152" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">402</span>: <span class="k">def</span> <span class="nf">bar_positions</span><span class="p">(</span><span class="n">x0</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="p">,</span> <span class="n">x1</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="p">,</span> <span class="n">b_dx</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="p">,</span></pre>
<pre class='cython code score-152 '>/* Python wrapper */
static PyArrayObject *__pyx_pw_6pyrost_3bin_9beam_calc_15bar_positions(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6pyrost_3bin_9beam_calc_14bar_positions[] = "bar_positions(double x0: cython.double, double x1: cython.double, double b_dx: cython.double, double rd: cython.double, unsigned long seed: cython.ulong) -&gt; np.ndarray\nGenerate a coordinate array of randomized barcode's bar positions.\n\n    Parameters\n    ----------\n    x0 : float\n        Barcode's lower bound along the x axis [um].\n    x1 : float\n        Barcode's upper bound along the x axis [um].\n    b_dx : float\n        Average bar's size [um].\n    rd : float\n        Random deviation of barcode's bar positions (0.0 - 1.0).\n    seed : int\n        Seed used for pseudo random number generation.\n\n    Returns\n    -------\n    bx_arr : numpy.ndarray\n        Array of barcode's bar coordinates.\n    ";
static PyMethodDef __pyx_mdef_6pyrost_3bin_9beam_calc_15bar_positions = {"bar_positions", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6pyrost_3bin_9beam_calc_15bar_positions, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6pyrost_3bin_9beam_calc_14bar_positions};
static PyArrayObject *__pyx_pw_6pyrost_3bin_9beam_calc_15bar_positions(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_x0;
  double __pyx_v_x1;
  double __pyx_v_b_dx;
  double __pyx_v_rd;
  unsigned long __pyx_v_seed;
  PyArrayObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("bar_positions (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_x0,&amp;__pyx_n_s_x1,&amp;__pyx_n_s_b_dx,&amp;__pyx_n_s_rd,&amp;__pyx_n_s_seed,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_x0)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_x1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("bar_positions", 1, 5, 5, 1); <span class='error_goto'>__PYX_ERR(0, 402, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_b_dx)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("bar_positions", 1, 5, 5, 2); <span class='error_goto'>__PYX_ERR(0, 402, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_rd)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("bar_positions", 1, 5, 5, 3); <span class='error_goto'>__PYX_ERR(0, 402, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_seed)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("bar_positions", 1, 5, 5, 4); <span class='error_goto'>__PYX_ERR(0, 402, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "bar_positions") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 402, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 5) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
    }
    __pyx_v_x0 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[0]); if (unlikely((__pyx_v_x0 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 402, __pyx_L3_error)</span>
    __pyx_v_x1 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_x1 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 402, __pyx_L3_error)</span>
    __pyx_v_b_dx = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_b_dx == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 402, __pyx_L3_error)</span>
    __pyx_v_rd = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_rd == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 403, __pyx_L3_error)</span>
    __pyx_v_seed = <span class='pyx_c_api'>__Pyx_PyInt_As_unsigned_long</span>(values[4]); if (unlikely((__pyx_v_seed == (unsigned long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 403, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("bar_positions", 1, 5, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 402, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.bar_positions", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6pyrost_3bin_9beam_calc_14bar_positions(__pyx_self, __pyx_v_x0, __pyx_v_x1, __pyx_v_b_dx, __pyx_v_rd, __pyx_v_seed);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyArrayObject *__pyx_pf_6pyrost_3bin_9beam_calc_14bar_positions(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_x0, double __pyx_v_x1, double __pyx_v_b_dx, double __pyx_v_rd, unsigned long __pyx_v_seed) {
  npy_intp __pyx_v_size;
  npy_intp *__pyx_v_dims;
  PyArrayObject *__pyx_v_bars = 0;
  double *__pyx_v__bars;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_bars;
  __Pyx_Buffer __pyx_pybuffer_bars;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("bar_positions", 0);
  __pyx_pybuffer_bars.pybuffer.buf = NULL;
  __pyx_pybuffer_bars.refcount = 0;
  __pyx_pybuffernd_bars.data = NULL;
  __pyx_pybuffernd_bars.rcbuffer = &amp;__pyx_pybuffer_bars;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_bars.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.bar_positions", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_bars.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_bars);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__24 = <span class='py_c_api'>PyTuple_Pack</span>(9, __pyx_n_s_x0, __pyx_n_s_x1, __pyx_n_s_b_dx, __pyx_n_s_rd, __pyx_n_s_seed, __pyx_n_s_size, __pyx_n_s_dims, __pyx_n_s_bars, __pyx_n_s_bars_2);<span class='error_goto'> if (unlikely(!__pyx_tuple__24)) __PYX_ERR(0, 402, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__24);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__24);
/* … */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(6);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 402, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_x0, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 402, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_x1, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 402, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_b_dx, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 402, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_rd, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 402, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_seed, __pyx_kp_u_unsigned_long) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 402, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_return, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 402, __pyx_L1_error)</span>
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_6pyrost_3bin_9beam_calc_15bar_positions, 0, __pyx_n_s_bar_positions, NULL, __pyx_n_s_pyrost_bin_beam_calc, __pyx_d, ((PyObject *)__pyx_codeobj__25));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 402, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetAnnotationsDict</span>(__pyx_t_5, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_bar_positions, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 402, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_codeobj__25 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(5, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__24, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_pyrost_bin_beam_calc_pyx, __pyx_n_s_bar_positions, 402, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__25)) __PYX_ERR(0, 402, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">403</span>:                   <span class="n">rd</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">ulong</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">404</span>:     <span class="sd">&quot;&quot;&quot;Generate a coordinate array of randomized barcode&#39;s bar positions.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">405</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">406</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">407</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">408</span>: <span class="sd">    x0 : float</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">409</span>: <span class="sd">        Barcode&#39;s lower bound along the x axis [um].</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">410</span>: <span class="sd">    x1 : float</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">411</span>: <span class="sd">        Barcode&#39;s upper bound along the x axis [um].</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">412</span>: <span class="sd">    b_dx : float</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">413</span>: <span class="sd">        Average bar&#39;s size [um].</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">414</span>: <span class="sd">    rd : float</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">415</span>: <span class="sd">        Random deviation of barcode&#39;s bar positions (0.0 - 1.0).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">416</span>: <span class="sd">    seed : int</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">417</span>: <span class="sd">        Seed used for pseudo random number generation.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">418</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">419</span>: <span class="sd">    Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">420</span>: <span class="sd">    -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">421</span>: <span class="sd">    bx_arr : numpy.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">422</span>: <span class="sd">        Array of barcode&#39;s bar coordinates.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">423</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">424</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> <span class="nf">size</span> <span class="o">=</span> <span class="mf">2</span> <span class="o">*</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">np</span><span class="o">.</span><span class="n">npy_intp</span><span class="o">&gt;</span><span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2</span> <span class="o">/</span> <span class="n">b_dx</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">x1</span> <span class="o">&gt;</span> <span class="n">x0</span> <span class="k">else</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  if (((__pyx_v_x1 &gt; __pyx_v_x0) != 0)) {
    __pyx_t_1 = (2 * (((npy_intp)(((__pyx_v_x1 - __pyx_v_x0) / 2.0) / __pyx_v_b_dx)) + 1));
  } else {
    __pyx_t_1 = 0;
  }
  __pyx_v_size = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">425</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> *<span class="nf">dims</span> <span class="o">=</span> <span class="p">[</span><span class="n">size</span><span class="p">,]</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2[0] = __pyx_v_size;
  __pyx_v_dims = __pyx_t_2;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">426</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="kt">double</span>] <span class="nf">bars</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">np.ndarray</span><span class="p">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_SimpleNew</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_FLOAT64</span><span class="p">)</span></pre>
<pre class='cython code score-10 '>  __pyx_t_3 = <span class='py_c_api'>PyArray_SimpleNew</span>(1, __pyx_v_dims, NPY_FLOAT64);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 426, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = __pyx_t_3;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_bars.rcbuffer-&gt;pybuffer, (PyObject*)((PyArrayObject *)__pyx_t_4), &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_bars = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_bars.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 426, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_bars.diminfo[0].strides = __pyx_pybuffernd_bars.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_bars.diminfo[0].shape = __pyx_pybuffernd_bars.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_v_bars = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">427</span>:     <span class="k">cdef</span> <span class="kt">double</span> *<span class="nf">_bars</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">bars</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__bars = ((double *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_v_bars)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">428</span>:     <span class="k">if</span> <span class="n">size</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_5 = (__pyx_v_size != 0);
  if (__pyx_t_5) {
/* … */
  }
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">429</span>:         <span class="k">with</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class='cython code score-4 '>    {
        #ifdef WITH_THREAD
        PyThreadState *_save;
        Py_UNBLOCK_THREADS
        <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
        #endif
        /*try:*/ {
/* … */
        /*finally:*/ {
          /*normal exit:*/{
            #ifdef WITH_THREAD
            <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
            Py_BLOCK_THREADS
            #endif
            goto __pyx_L6;
          }
          __pyx_L6:;
        }
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">430</span>:             <span class="n">barcode_bars</span><span class="p">(</span><span class="n">_bars</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">b_dx</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          barcode_bars(__pyx_v__bars, __pyx_v_size, __pyx_v_x0, __pyx_v_b_dx, __pyx_v_rd, __pyx_v_seed);
        }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">431</span>:     <span class="k">return</span> <span class="n">bars</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_bars));
  __pyx_r = ((PyArrayObject *)__pyx_v_bars);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">432</span>: </pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">433</span>: <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span> <span class="nf">ml_profile_wrapper</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="n">x_arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">]</span> <span class="n">layers</span><span class="p">,</span> <span class="nb">complex</span> <span class="n">mt0</span><span class="p">,</span></pre>
<pre class='cython code score-19 '>static PyArrayObject *__pyx_f_6pyrost_3bin_9beam_calc_ml_profile_wrapper(PyArrayObject *__pyx_v_x_arr, PyArrayObject *__pyx_v_layers, __pyx_t_double_complex __pyx_v_mt0, __pyx_t_double_complex __pyx_v_mt1, __pyx_t_double_complex __pyx_v_mt2, double __pyx_v_sigma, unsigned int __pyx_v_num_threads) {
  npy_intp __pyx_v_npts;
  npy_intp __pyx_v_nlyr;
  int __pyx_v_ndim;
  npy_intp *__pyx_v_dims;
  PyArrayObject *__pyx_v_out = 0;
  __pyx_t_double_complex *__pyx_v__out;
  double *__pyx_v__x;
  double *__pyx_v__lyrs;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_layers;
  __Pyx_Buffer __pyx_pybuffer_layers;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("ml_profile_wrapper", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_x_arr);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_layers);
  __pyx_pybuffer_layers.pybuffer.buf = NULL;
  __pyx_pybuffer_layers.refcount = 0;
  __pyx_pybuffernd_layers.data = NULL;
  __pyx_pybuffernd_layers.rcbuffer = &amp;__pyx_pybuffer_layers;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_layers.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_layers, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 433, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_layers.diminfo[0].strides = __pyx_pybuffernd_layers.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_layers.diminfo[0].shape = __pyx_pybuffernd_layers.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_layers.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.ml_profile_wrapper", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_layers.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_out);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_x_arr);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_layers);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">434</span>:                                    <span class="nb">complex</span> <span class="n">mt1</span><span class="p">,</span> <span class="nb">complex</span> <span class="n">mt2</span><span class="p">,</span> <span class="n">double</span> <span class="n">sigma</span><span class="p">,</span> <span class="nb">unsigned</span> <span class="n">num_threads</span><span class="p">):</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">435</span>:     <span class="n">x_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_GETCONTIGUOUS</span><span class="p">(</span><span class="n">x_arr</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>  __pyx_t_1 = ((PyObject *)<span class='py_macro_api'>PyArray_GETCONTIGUOUS</span>(__pyx_v_x_arr));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 435, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_x_arr, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">436</span>:     <span class="n">x_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_Cast</span><span class="p">(</span><span class="n">x_arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_FLOAT64</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='py_c_api'>PyArray_Cast</span>(__pyx_v_x_arr, NPY_FLOAT64);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 436, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 436, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_x_arr, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">437</span>:     <span class="n">layers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_GETCONTIGUOUS</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span></pre>
<pre class='cython code score-20 '>  __pyx_t_1 = ((PyObject *)<span class='py_macro_api'>PyArray_GETCONTIGUOUS</span>(((PyArrayObject *)__pyx_v_layers)));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 437, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_layers.rcbuffer-&gt;pybuffer);
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_layers.rcbuffer-&gt;pybuffer, (PyObject*)((PyArrayObject *)__pyx_t_1), &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_2 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_3, &amp;__pyx_t_4, &amp;__pyx_t_5);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_layers.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_layers, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_3); Py_XDECREF(__pyx_t_4); Py_XDECREF(__pyx_t_5);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_3, __pyx_t_4, __pyx_t_5);
      }
      __pyx_t_3 = __pyx_t_4 = __pyx_t_5 = 0;
    }
    __pyx_pybuffernd_layers.diminfo[0].strides = __pyx_pybuffernd_layers.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_layers.diminfo[0].shape = __pyx_pybuffernd_layers.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 437, __pyx_L1_error)</span>
  }
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_layers, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-26" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">438</span>:     <span class="n">layers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_Cast</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_FLOAT64</span><span class="p">)</span></pre>
<pre class='cython code score-26 '>  __pyx_t_1 = <span class='py_c_api'>PyArray_Cast</span>(((PyArrayObject *)__pyx_v_layers), NPY_FLOAT64);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 438, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 438, __pyx_L1_error)</span>
  __pyx_t_6 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_layers.rcbuffer-&gt;pybuffer);
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_layers.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_2 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_5, &amp;__pyx_t_4, &amp;__pyx_t_3);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_layers.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_layers, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_4); Py_XDECREF(__pyx_t_3);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_5, __pyx_t_4, __pyx_t_3);
      }
      __pyx_t_5 = __pyx_t_4 = __pyx_t_3 = 0;
    }
    __pyx_pybuffernd_layers.diminfo[0].strides = __pyx_pybuffernd_layers.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_layers.diminfo[0].shape = __pyx_pybuffernd_layers.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 438, __pyx_L1_error)</span>
  }
  __pyx_t_6 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_layers, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">439</span>: </pre>
<pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">440</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> <span class="nf">npts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_SIZE</span><span class="p">(</span><span class="n">x_arr</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v_npts = <span class='py_macro_api'>PyArray_SIZE</span>(__pyx_v_x_arr);
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">441</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> <span class="nf">nlyr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_SIZE</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v_nlyr = <span class='py_macro_api'>PyArray_SIZE</span>(((PyArrayObject *)__pyx_v_layers));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">442</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="n">x_arr</span><span class="o">.</span><span class="n">ndim</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_v_x_arr-&gt;nd;
  __pyx_v_ndim = __pyx_t_2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">443</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> *<span class="nf">dims</span> <span class="o">=</span> <span class="n">x_arr</span><span class="o">.</span><span class="n">shape</span></pre>
<pre class='cython code score-0 '>  __pyx_t_7 = __pyx_v_x_arr-&gt;dimensions;
  __pyx_v_dims = __pyx_t_7;
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">444</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span> <span class="nf">out</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">np.ndarray</span><span class="p">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_SimpleNew</span><span class="p">(</span><span class="n">ndim</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_COMPLEX128</span><span class="p">)</span></pre>
<pre class='cython code score-7 '>  __pyx_t_1 = <span class='py_c_api'>PyArray_SimpleNew</span>(__pyx_v_ndim, __pyx_v_dims, NPY_COMPLEX128);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 444, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_8 = __pyx_t_1;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_out = ((PyArrayObject *)__pyx_t_8);
  __pyx_t_8 = 0;
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">445</span>:     <span class="k">cdef</span> <span class="kt">complex</span> *<span class="nf">_out</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nb">complex</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">out</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__out = ((__pyx_t_double_complex *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_out));
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">446</span>:     <span class="k">cdef</span> <span class="kt">double</span> *<span class="nf">_x</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">x_arr</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__x = ((double *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_x_arr));
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">447</span>:     <span class="k">cdef</span> <span class="kt">double</span> *<span class="nf">_lyrs</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__lyrs = ((double *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_v_layers)));
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">448</span>:     <span class="k">with</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class='cython code score-4 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L5;
        }
        __pyx_L5:;
      }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">449</span>:         <span class="n">ml_profile</span><span class="p">(</span><span class="n">_out</span><span class="p">,</span> <span class="n">_x</span><span class="p">,</span> <span class="n">_lyrs</span><span class="p">,</span> <span class="n">npts</span><span class="p">,</span> <span class="n">nlyr</span><span class="p">,</span> <span class="n">mt0</span><span class="p">,</span> <span class="n">mt1</span><span class="p">,</span> <span class="n">mt2</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        ml_profile(__pyx_v__out, __pyx_v__x, __pyx_v__lyrs, __pyx_v_npts, __pyx_v_nlyr, __pyx_v_mt0, __pyx_v_mt1, __pyx_v_mt2, __pyx_v_sigma, __pyx_v_num_threads);
      }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">450</span>:     <span class="k">return</span> <span class="n">out</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_out));
  __pyx_r = __pyx_v_out;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">451</span>: </pre>
<pre class="cython line score-147" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">452</span>: <span class="k">def</span> <span class="nf">barcode_profile</span><span class="p">(</span><span class="n">x_arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">bars</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">bulk_atn</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="p">,</span></pre>
<pre class='cython code score-147 '>/* Python wrapper */
static PyArrayObject *__pyx_pw_6pyrost_3bin_9beam_calc_17barcode_profile(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6pyrost_3bin_9beam_calc_16barcode_profile[] = "barcode_profile(ndarray x_arr: np.ndarray, ndarray bars: np.ndarray, double bulk_atn: cython.double, double bar_atn: cython.double, double bar_sigma: cython.double, unsigned int num_threads: cython.uint) -&gt; np.ndarray\nReturn an array of barcode's transmission profile calculated\n    at `x_arr` coordinates.\n\n    Parameters\n    ----------\n    x_arr : numpy.ndarray\n        Array of the coordinates, where the transmission coefficients\n        are calculated [um].    \n    bars : numpy.ndarray\n        Coordinates of barcode's bar positions [um].\n    bulk_atn : float\n        Barcode's bulk attenuation coefficient (0.0 - 1.0).\n    bar_atn : float\n        Barcode's bar attenuation coefficient (0.0 - 1.0).\n    bar_sigma : float\n        Bar's blurriness width [um].\n    num_threads : int, optional\n        Number of threads.\n    \n    Returns\n    -------\n    bar_profile : numpy.ndarray\n        Array of barcode's transmission profiles.\n\n    Notes\n    -----\n    Barcode's transmission profile is simulated with a set\n    of error functions:\n    \n    .. math::\n        \\begin{multline}\n            T_{b}(x) = 1 - \\frac{T_{bulk}}{2} \\left\\{\n            \\mathrm{erf}\\left[ \\frac{x - x_{bar}[0]}{\\sqrt{2} \\sigma} \\right] +\n            \\mathrm{erf}\\left[ \\frac{x_{bar}[n - 1] - x}{\\sqrt{2} \\sigma} \\right]\n            \\right\\} -\\\\\n            \\frac{T_{bar}}{4} \\sum_{i = 1}^{n - 2} \\left\\{\n            2 \\mathrm{erf}\\left[ \\frac{x - x_{bar}[i]}{\\sqrt{2} \\sigma} \\right] -\n            \\mathrm{erf}\\left[ \\frac{x - x_{bar}[i - 1]}{\\sqrt{2} \\sigma} \\right] -\n            \\mathrm{erf}\\left[ \\frac{x - x_{bar}[i + 1]}{\\sqrt{2} \\sigma} \\right]\n            \\right\\}\n        \\end{multline}\n    \n    where :math:`x_{bar}` is an array of bar coordinates.\n    ";
static PyMethodDef __pyx_mdef_6pyrost_3bin_9beam_calc_17barcode_profile = {"barcode_profile", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6pyrost_3bin_9beam_calc_17barcode_profile, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6pyrost_3bin_9beam_calc_16barcode_profile};
static PyArrayObject *__pyx_pw_6pyrost_3bin_9beam_calc_17barcode_profile(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_x_arr = 0;
  PyArrayObject *__pyx_v_bars = 0;
  double __pyx_v_bulk_atn;
  double __pyx_v_bar_atn;
  double __pyx_v_bar_sigma;
  unsigned int __pyx_v_num_threads;
  PyArrayObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("barcode_profile (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_x_arr,&amp;__pyx_n_s_bars,&amp;__pyx_n_s_bulk_atn,&amp;__pyx_n_s_bar_atn,&amp;__pyx_n_s_bar_sigma,&amp;__pyx_n_s_num_threads,0};
    PyObject* values[6] = {0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_x_arr)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_bars)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("barcode_profile", 1, 6, 6, 1); <span class='error_goto'>__PYX_ERR(0, 452, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_bulk_atn)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("barcode_profile", 1, 6, 6, 2); <span class='error_goto'>__PYX_ERR(0, 452, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_bar_atn)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("barcode_profile", 1, 6, 6, 3); <span class='error_goto'>__PYX_ERR(0, 452, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_bar_sigma)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("barcode_profile", 1, 6, 6, 4); <span class='error_goto'>__PYX_ERR(0, 452, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_num_threads)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("barcode_profile", 1, 6, 6, 5); <span class='error_goto'>__PYX_ERR(0, 452, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "barcode_profile") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 452, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 6) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
    }
    __pyx_v_x_arr = ((PyArrayObject *)values[0]);
    __pyx_v_bars = ((PyArrayObject *)values[1]);
    __pyx_v_bulk_atn = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_bulk_atn == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 452, __pyx_L3_error)</span>
    __pyx_v_bar_atn = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_bar_atn == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 453, __pyx_L3_error)</span>
    __pyx_v_bar_sigma = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_bar_sigma == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 453, __pyx_L3_error)</span>
    __pyx_v_num_threads = <span class='pyx_c_api'>__Pyx_PyInt_As_unsigned_int</span>(values[5]); if (unlikely((__pyx_v_num_threads == (unsigned int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 454, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("barcode_profile", 1, 6, 6, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 452, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.barcode_profile", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_x_arr), __pyx_ptype_5numpy_ndarray, 1, "x_arr", 0))) <span class='error_goto'>__PYX_ERR(0, 452, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_bars), __pyx_ptype_5numpy_ndarray, 1, "bars", 0))) <span class='error_goto'>__PYX_ERR(0, 452, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_6pyrost_3bin_9beam_calc_16barcode_profile(__pyx_self, __pyx_v_x_arr, __pyx_v_bars, __pyx_v_bulk_atn, __pyx_v_bar_atn, __pyx_v_bar_sigma, __pyx_v_num_threads);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyArrayObject *__pyx_pf_6pyrost_3bin_9beam_calc_16barcode_profile(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_x_arr, PyArrayObject *__pyx_v_bars, double __pyx_v_bulk_atn, double __pyx_v_bar_atn, double __pyx_v_bar_sigma, unsigned int __pyx_v_num_threads) {
  __pyx_t_double_complex __pyx_v_mt0;
  __pyx_t_double_complex __pyx_v_mt1;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("barcode_profile", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.barcode_profile", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__26 = <span class='py_c_api'>PyTuple_Pack</span>(8, __pyx_n_s_x_arr, __pyx_n_s_bars, __pyx_n_s_bulk_atn, __pyx_n_s_bar_atn, __pyx_n_s_bar_sigma, __pyx_n_s_num_threads, __pyx_n_s_mt0, __pyx_n_s_mt1);<span class='error_goto'> if (unlikely(!__pyx_tuple__26)) __PYX_ERR(0, 452, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__26);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__26);
/* … */
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(7);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 452, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_x_arr, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 452, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_bars, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 452, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_bulk_atn, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 452, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_bar_atn, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 452, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_bar_sigma, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 452, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_num_threads, __pyx_kp_u_unsigned_int) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 452, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_return, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 452, __pyx_L1_error)</span>
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_6pyrost_3bin_9beam_calc_17barcode_profile, 0, __pyx_n_s_barcode_profile, NULL, __pyx_n_s_pyrost_bin_beam_calc, __pyx_d, ((PyObject *)__pyx_codeobj__27));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 452, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetAnnotationsDict</span>(__pyx_t_4, __pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_barcode_profile, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 452, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_codeobj__27 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(6, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__26, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_pyrost_bin_beam_calc_pyx, __pyx_n_s_barcode_profile, 452, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__27)) __PYX_ERR(0, 452, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">453</span>:                     <span class="n">bar_atn</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="p">,</span> <span class="n">bar_sigma</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">454</span>:                     <span class="n">num_threads</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">uint</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">455</span>:     <span class="s">r&quot;&quot;&quot;Return an array of barcode&#39;s transmission profile calculated</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">456</span>: <span class="s">    at `x_arr` coordinates.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">457</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">458</span>: <span class="s">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">459</span>: <span class="s">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">460</span>: <span class="s">    x_arr : numpy.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">461</span>: <span class="s">        Array of the coordinates, where the transmission coefficients</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">462</span>: <span class="s">        are calculated [um].    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">463</span>: <span class="s">    bars : numpy.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">464</span>: <span class="s">        Coordinates of barcode&#39;s bar positions [um].</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">465</span>: <span class="s">    bulk_atn : float</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">466</span>: <span class="s">        Barcode&#39;s bulk attenuation coefficient (0.0 - 1.0).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">467</span>: <span class="s">    bar_atn : float</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">468</span>: <span class="s">        Barcode&#39;s bar attenuation coefficient (0.0 - 1.0).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">469</span>: <span class="s">    bar_sigma : float</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">470</span>: <span class="s">        Bar&#39;s blurriness width [um].</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">471</span>: <span class="s">    num_threads : int, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">472</span>: <span class="s">        Number of threads.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">473</span>: <span class="s">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">474</span>: <span class="s">    Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">475</span>: <span class="s">    -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">476</span>: <span class="s">    bar_profile : numpy.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">477</span>: <span class="s">        Array of barcode&#39;s transmission profiles.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">478</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">479</span>: <span class="s">    Notes</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">480</span>: <span class="s">    -----</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">481</span>: <span class="s">    Barcode&#39;s transmission profile is simulated with a set</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">482</span>: <span class="s">    of error functions:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">483</span>: <span class="s">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">484</span>: <span class="s">    .. math::</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">485</span>: <span class="s">        \begin{multline}</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">486</span>: <span class="s">            T_{b}(x) = 1 - \frac{T_{bulk}}{2} \left\{</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">487</span>: <span class="s">            \mathrm{erf}\left[ \frac{x - x_{bar}[0]}{\sqrt{2} \sigma} \right] +</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">488</span>: <span class="s">            \mathrm{erf}\left[ \frac{x_{bar}[n - 1] - x}{\sqrt{2} \sigma} \right]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">489</span>: <span class="s">            \right\} -\\</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">490</span>: <span class="s">            \frac{T_{bar}}{4} \sum_{i = 1}^{n - 2} \left\{</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">491</span>: <span class="s">            2 \mathrm{erf}\left[ \frac{x - x_{bar}[i]}{\sqrt{2} \sigma} \right] -</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">492</span>: <span class="s">            \mathrm{erf}\left[ \frac{x - x_{bar}[i - 1]}{\sqrt{2} \sigma} \right] -</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">493</span>: <span class="s">            \mathrm{erf}\left[ \frac{x - x_{bar}[i + 1]}{\sqrt{2} \sigma} \right]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">494</span>: <span class="s">            \right\}</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">495</span>: <span class="s">        \end{multline}</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">496</span>: <span class="s">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">497</span>: <span class="s">    where :math:`x_{bar}` is an array of bar coordinates.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">498</span>: <span class="s">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">499</span>:     <span class="k">cdef</span> <span class="kt">complex</span> <span class="nf">mt0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">bulk_atn</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_mt0 = __Pyx_c_prod_double(__Pyx_c_neg_double(__pyx_t_double_complex_from_parts(0, 1.0)), __pyx_t_double_complex_from_parts(log((1.0 - __pyx_v_bulk_atn)), 0));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">500</span>:     <span class="k">cdef</span> <span class="kt">complex</span> <span class="nf">mt1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">bar_atn</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_mt1 = __Pyx_c_prod_double(__Pyx_c_neg_double(__pyx_t_double_complex_from_parts(0, 1.0)), __pyx_t_double_complex_from_parts(log((1.0 - __pyx_v_bar_atn)), 0));
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">501</span>:     <span class="k">return</span> <span class="n">ml_profile_wrapper</span><span class="p">(</span><span class="n">x_arr</span><span class="p">,</span> <span class="n">bars</span><span class="p">,</span> <span class="n">mt0</span><span class="p">,</span> <span class="n">mt1</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">bar_sigma</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  __pyx_t_1 = ((PyObject *)__pyx_f_6pyrost_3bin_9beam_calc_ml_profile_wrapper(__pyx_v_x_arr, ((PyArrayObject *)__pyx_v_bars), __pyx_v_mt0, __pyx_v_mt1, __pyx_t_double_complex_from_parts(0., 0), __pyx_v_bar_sigma, __pyx_v_num_threads));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 501, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">502</span>: </pre>
<pre class="cython line score-121" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">503</span>: <span class="k">def</span> <span class="nf">mll_profile</span><span class="p">(</span><span class="n">x_arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">layers</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">complex</span> <span class="n">mt0</span><span class="p">,</span></pre>
<pre class='cython code score-121 '>/* Python wrapper */
static PyArrayObject *__pyx_pw_6pyrost_3bin_9beam_calc_19mll_profile(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6pyrost_3bin_9beam_calc_18mll_profile[] = "mll_profile(ndarray x_arr: np.ndarray, ndarray layers: np.ndarray, double complex mt0, double complex mt1, double sigma: cython.double, unsigned int num_threads: cython.uint) -&gt; np.ndarray";
static PyMethodDef __pyx_mdef_6pyrost_3bin_9beam_calc_19mll_profile = {"mll_profile", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6pyrost_3bin_9beam_calc_19mll_profile, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6pyrost_3bin_9beam_calc_18mll_profile};
static PyArrayObject *__pyx_pw_6pyrost_3bin_9beam_calc_19mll_profile(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_x_arr = 0;
  PyArrayObject *__pyx_v_layers = 0;
  __pyx_t_double_complex __pyx_v_mt0;
  __pyx_t_double_complex __pyx_v_mt1;
  double __pyx_v_sigma;
  unsigned int __pyx_v_num_threads;
  PyArrayObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("mll_profile (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_x_arr,&amp;__pyx_n_s_layers,&amp;__pyx_n_s_mt0,&amp;__pyx_n_s_mt1,&amp;__pyx_n_s_sigma,&amp;__pyx_n_s_num_threads,0};
    PyObject* values[6] = {0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_x_arr)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_layers)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mll_profile", 1, 6, 6, 1); <span class='error_goto'>__PYX_ERR(0, 503, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_mt0)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mll_profile", 1, 6, 6, 2); <span class='error_goto'>__PYX_ERR(0, 503, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_mt1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mll_profile", 1, 6, 6, 3); <span class='error_goto'>__PYX_ERR(0, 503, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sigma)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mll_profile", 1, 6, 6, 4); <span class='error_goto'>__PYX_ERR(0, 503, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_num_threads)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mll_profile", 1, 6, 6, 5); <span class='error_goto'>__PYX_ERR(0, 503, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "mll_profile") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 503, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 6) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
    }
    __pyx_v_x_arr = ((PyArrayObject *)values[0]);
    __pyx_v_layers = ((PyArrayObject *)values[1]);
    __pyx_v_mt0 = <span class='pyx_c_api'>__Pyx_PyComplex_As___pyx_t_double_complex</span>(values[2]);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L3_error)</span>
    __pyx_v_mt1 = <span class='pyx_c_api'>__Pyx_PyComplex_As___pyx_t_double_complex</span>(values[3]);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L3_error)</span>
    __pyx_v_sigma = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_sigma == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 504, __pyx_L3_error)</span>
    __pyx_v_num_threads = <span class='pyx_c_api'>__Pyx_PyInt_As_unsigned_int</span>(values[5]); if (unlikely((__pyx_v_num_threads == (unsigned int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 504, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mll_profile", 1, 6, 6, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 503, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.mll_profile", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_x_arr), __pyx_ptype_5numpy_ndarray, 1, "x_arr", 0))) <span class='error_goto'>__PYX_ERR(0, 503, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_layers), __pyx_ptype_5numpy_ndarray, 1, "layers", 0))) <span class='error_goto'>__PYX_ERR(0, 503, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_6pyrost_3bin_9beam_calc_18mll_profile(__pyx_self, __pyx_v_x_arr, __pyx_v_layers, __pyx_v_mt0, __pyx_v_mt1, __pyx_v_sigma, __pyx_v_num_threads);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyArrayObject *__pyx_pf_6pyrost_3bin_9beam_calc_18mll_profile(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_x_arr, PyArrayObject *__pyx_v_layers, __pyx_t_double_complex __pyx_v_mt0, __pyx_t_double_complex __pyx_v_mt1, double __pyx_v_sigma, unsigned int __pyx_v_num_threads) {
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("mll_profile", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.mll_profile", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__28 = <span class='py_c_api'>PyTuple_Pack</span>(6, __pyx_n_s_x_arr, __pyx_n_s_layers, __pyx_n_s_mt0, __pyx_n_s_mt1, __pyx_n_s_sigma, __pyx_n_s_num_threads);<span class='error_goto'> if (unlikely(!__pyx_tuple__28)) __PYX_ERR(0, 503, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__28);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__28);
/* … */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 503, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_x_arr, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 503, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_layers, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 503, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_sigma, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 503, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_num_threads, __pyx_kp_u_unsigned_int) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 503, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_return, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 503, __pyx_L1_error)</span>
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_6pyrost_3bin_9beam_calc_19mll_profile, 0, __pyx_n_s_mll_profile, NULL, __pyx_n_s_pyrost_bin_beam_calc, __pyx_d, ((PyObject *)__pyx_codeobj__29));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 503, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetAnnotationsDict</span>(__pyx_t_5, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_mll_profile, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 503, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_codeobj__29 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(6, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__28, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_pyrost_bin_beam_calc_pyx, __pyx_n_s_mll_profile, 503, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__29)) __PYX_ERR(0, 503, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">504</span>:                 <span class="nb">complex</span> <span class="n">mt1</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">uint</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span></pre>
<pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">505</span>:     <span class="k">return</span> <span class="n">ml_profile_wrapper</span><span class="p">(</span><span class="n">x_arr</span><span class="p">,</span> <span class="n">layers</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">mt0</span><span class="p">,</span> <span class="n">mt1</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  __pyx_t_1 = ((PyObject *)__pyx_f_6pyrost_3bin_9beam_calc_ml_profile_wrapper(__pyx_v_x_arr, ((PyArrayObject *)__pyx_v_layers), __pyx_t_double_complex_from_parts(0., 0), __pyx_v_mt0, __pyx_v_mt1, __pyx_v_sigma, __pyx_v_num_threads));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 505, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">506</span>: </pre>
<pre class="cython line score-163" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">507</span>: <span class="k">def</span> <span class="nf">fft_convolve</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">kernel</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">int</span><span class="o">=-</span><span class="mf">1</span><span class="p">,</span></pre>
<pre class='cython code score-163 '>/* Python wrapper */
static PyArrayObject *__pyx_pw_6pyrost_3bin_9beam_calc_21fft_convolve(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6pyrost_3bin_9beam_calc_20fft_convolve[] = "fft_convolve(ndarray array: np.ndarray, ndarray kernel: np.ndarray, int axis: cython.int = -1, unicode mode: str = u'constant', double cval: cython.double = 0.0, unicode backend: str = u'fftw', unsigned int num_threads: cython.uint = 1) -&gt; np.ndarray\nConvolve a multi-dimensional `array` with one-dimensional `kernel` along the\n    `axis` by means of FFT. Output has the same size as `array`.\n\n    Parameters\n    ----------\n    array : numpy.ndarray\n        Input array.\n    kernel : numpy.ndarray\n        Kernel array.\n    axis : int, optional\n        Array axis along which convolution is performed.\n    backend : {'fftw', 'numpy'}, optional\n        Choose backend library for the FFT implementation.\n    num_threads : int, optional\n        Number of threads.\n\n    Returns\n    -------\n    out : numpy.ndarray\n        A multi-dimensional array containing the discrete linear\n        convolution of `array` with `kernel`.\n    ";
static PyMethodDef __pyx_mdef_6pyrost_3bin_9beam_calc_21fft_convolve = {"fft_convolve", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6pyrost_3bin_9beam_calc_21fft_convolve, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6pyrost_3bin_9beam_calc_20fft_convolve};
static PyArrayObject *__pyx_pw_6pyrost_3bin_9beam_calc_21fft_convolve(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_array = 0;
  PyArrayObject *__pyx_v_kernel = 0;
  int __pyx_v_axis;
  PyObject *__pyx_v_mode = 0;
  double __pyx_v_cval;
  PyObject *__pyx_v_backend = 0;
  unsigned int __pyx_v_num_threads;
  PyArrayObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("fft_convolve (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_array,&amp;__pyx_n_s_kernel,&amp;__pyx_n_s_axis,&amp;__pyx_n_s_mode,&amp;__pyx_n_s_cval,&amp;__pyx_n_s_backend,&amp;__pyx_n_s_num_threads,0};
    PyObject* values[7] = {0,0,0,0,0,0,0};
    values[3] = ((PyObject*)((PyObject*)__pyx_n_u_constant));
    values[5] = ((PyObject*)((PyObject*)__pyx_n_u_fftw));
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_array)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_kernel)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("fft_convolve", 0, 2, 7, 1); <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_axis);
          if (value) { values[2] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_mode);
          if (value) { values[3] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_cval);
          if (value) { values[4] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_backend);
          if (value) { values[5] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_num_threads);
          if (value) { values[6] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "fft_convolve") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_array = ((PyArrayObject *)values[0]);
    __pyx_v_kernel = ((PyArrayObject *)values[1]);
    if (values[2]) {
      __pyx_v_axis = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[2]); if (unlikely((__pyx_v_axis == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L3_error)</span>
    } else {
      __pyx_v_axis = ((int)((int)-1));
    }
    __pyx_v_mode = ((PyObject*)values[3]);
    if (values[4]) {
      __pyx_v_cval = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_cval == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 508, __pyx_L3_error)</span>
    } else {
      __pyx_v_cval = ((double)((double)0.0));
    }
    __pyx_v_backend = ((PyObject*)values[5]);
    if (values[6]) {
      __pyx_v_num_threads = <span class='pyx_c_api'>__Pyx_PyInt_As_unsigned_int</span>(values[6]); if (unlikely((__pyx_v_num_threads == (unsigned int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 509, __pyx_L3_error)</span>
    } else {
      __pyx_v_num_threads = ((unsigned int)((unsigned int)1));
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("fft_convolve", 0, 2, 7, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.fft_convolve", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_array), __pyx_ptype_5numpy_ndarray, 1, "array", 0))) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_kernel), __pyx_ptype_5numpy_ndarray, 1, "kernel", 0))) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_mode), (&amp;PyUnicode_Type), 1, "mode", 1))) <span class='error_goto'>__PYX_ERR(0, 508, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_backend), (&amp;PyUnicode_Type), 1, "backend", 1))) <span class='error_goto'>__PYX_ERR(0, 508, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_6pyrost_3bin_9beam_calc_20fft_convolve(__pyx_self, __pyx_v_array, __pyx_v_kernel, __pyx_v_axis, __pyx_v_mode, __pyx_v_cval, __pyx_v_backend, __pyx_v_num_threads);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyArrayObject *__pyx_pf_6pyrost_3bin_9beam_calc_20fft_convolve(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_array, PyArrayObject *__pyx_v_kernel, int __pyx_v_axis, PyObject *__pyx_v_mode, double __pyx_v_cval, PyObject *__pyx_v_backend, unsigned int __pyx_v_num_threads) {
  npy_intp __pyx_v_isize;
  int __pyx_v_ndim;
  npy_intp __pyx_v_npts;
  int __pyx_v_istride;
  npy_intp __pyx_v_ksize;
  int __pyx_v__mode;
  npy_intp *__pyx_v_dims;
  PyArrayObject *__pyx_v_out = 0;
  double *__pyx_v__out;
  double *__pyx_v__inp;
  double *__pyx_v__krn;
  int __pyx_v_fail;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("fft_convolve", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_array);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_kernel);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.fft_convolve", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_out);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_array);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_kernel);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__30 = <span class='py_c_api'>PyTuple_Pack</span>(19, __pyx_n_s_array, __pyx_n_s_kernel, __pyx_n_s_axis, __pyx_n_s_mode, __pyx_n_s_cval, __pyx_n_s_backend, __pyx_n_s_num_threads, __pyx_n_s_isize, __pyx_n_s_ndim, __pyx_n_s_npts, __pyx_n_s_istride, __pyx_n_s_ksize, __pyx_n_s_mode_2, __pyx_n_s_dims, __pyx_n_s_out, __pyx_n_s_out_2, __pyx_n_s_inp_2, __pyx_n_s_krn, __pyx_n_s_fail);<span class='error_goto'> if (unlikely(!__pyx_tuple__30)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__30);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__30);
/* … */
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(((int)-1));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
/* … */
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject*)__pyx_n_u_constant));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject*)__pyx_n_u_constant));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject*)__pyx_n_u_constant));
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 2, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject*)__pyx_n_u_fftw));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject*)__pyx_n_u_fftw));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 3, ((PyObject*)__pyx_n_u_fftw));
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 4, __pyx_t_3);
  __pyx_t_5 = 0;
  __pyx_t_4 = 0;
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(8);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_array, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_kernel, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_axis, __pyx_n_u_int) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_mode, __pyx_n_u_unicode) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_cval, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_backend, __pyx_n_u_unicode) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_num_threads, __pyx_kp_u_unsigned_int) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_return, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L1_error)</span>
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_6pyrost_3bin_9beam_calc_21fft_convolve, 0, __pyx_n_s_fft_convolve, NULL, __pyx_n_s_pyrost_bin_beam_calc, __pyx_d, ((PyObject *)__pyx_codeobj__31));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsTuple</span>(__pyx_t_4, __pyx_t_1);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetAnnotationsDict</span>(__pyx_t_4, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_fft_convolve, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_codeobj__31 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(7, 0, 19, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__30, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_pyrost_bin_beam_calc_pyx, __pyx_n_s_fft_convolve, 507, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__31)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">508</span>:                  <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s">&#39;constant&#39;</span><span class="p">,</span> <span class="n">cval</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s">&#39;fftw&#39;</span><span class="p">,</span></pre>
<pre class='cython code score-5 '>  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(((double)0.0));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 508, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">509</span>:                  <span class="n">num_threads</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">uint</span><span class="o">=</span><span class="mf">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_unsigned_int</span>(((unsigned int)1));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 509, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
</pre><pre class="cython line score-0">&#xA0;<span class="">510</span>:     <span class="sd">&quot;&quot;&quot;Convolve a multi-dimensional `array` with one-dimensional `kernel` along the</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">511</span>: <span class="sd">    `axis` by means of FFT. Output has the same size as `array`.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">512</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">513</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">514</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">515</span>: <span class="sd">    array : numpy.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">516</span>: <span class="sd">        Input array.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">517</span>: <span class="sd">    kernel : numpy.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">518</span>: <span class="sd">        Kernel array.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">519</span>: <span class="sd">    axis : int, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">520</span>: <span class="sd">        Array axis along which convolution is performed.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">521</span>: <span class="sd">    backend : {&#39;fftw&#39;, &#39;numpy&#39;}, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">522</span>: <span class="sd">        Choose backend library for the FFT implementation.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">523</span>: <span class="sd">    num_threads : int, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">524</span>: <span class="sd">        Number of threads.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">525</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">526</span>: <span class="sd">    Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">527</span>: <span class="sd">    -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">528</span>: <span class="sd">    out : numpy.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">529</span>: <span class="sd">        A multi-dimensional array containing the discrete linear</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">530</span>: <span class="sd">        convolution of `array` with `kernel`.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">531</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">532</span>:     <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_GETCONTIGUOUS</span><span class="p">(</span><span class="n">array</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>  __pyx_t_1 = ((PyObject *)<span class='py_macro_api'>PyArray_GETCONTIGUOUS</span>(__pyx_v_array));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 532, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_array, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">533</span>:     <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_Cast</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_FLOAT64</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='py_c_api'>PyArray_Cast</span>(__pyx_v_array, NPY_FLOAT64);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 533, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 533, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_array, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">534</span>:     <span class="n">kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_GETCONTIGUOUS</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>  __pyx_t_1 = ((PyObject *)<span class='py_macro_api'>PyArray_GETCONTIGUOUS</span>(__pyx_v_kernel));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 534, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_kernel, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">535</span>:     <span class="n">kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_Cast</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_FLOAT64</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='py_c_api'>PyArray_Cast</span>(__pyx_v_kernel, NPY_FLOAT64);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 535, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 535, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_kernel, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">536</span>: </pre>
<pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">537</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> <span class="nf">isize</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_SIZE</span><span class="p">(</span><span class="n">array</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v_isize = <span class='py_macro_api'>PyArray_SIZE</span>(__pyx_v_array);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">538</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_v_array-&gt;nd;
  __pyx_v_ndim = __pyx_t_2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">539</span>:     <span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span> <span class="k">if</span> <span class="n">axis</span> <span class="o">&gt;=</span> <span class="mf">0</span> <span class="k">else</span> <span class="n">ndim</span> <span class="o">+</span> <span class="n">axis</span></pre>
<pre class='cython code score-0 '>  if (((__pyx_v_axis &gt;= 0) != 0)) {
    __pyx_t_2 = __pyx_v_axis;
  } else {
    __pyx_t_2 = (__pyx_v_ndim + __pyx_v_axis);
  }
  __pyx_v_axis = __pyx_t_2;
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">540</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> <span class="nf">npts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_DIM</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v_npts = <span class='py_macro_api'>PyArray_DIM</span>(__pyx_v_array, __pyx_v_axis);
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">541</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">istride</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_STRIDE</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_ITEMSIZE</span><span class="p">(</span><span class="n">array</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>  __pyx_v_istride = (<span class='py_macro_api'>PyArray_STRIDE</span>(__pyx_v_array, __pyx_v_axis) / <span class='py_macro_api'>PyArray_ITEMSIZE</span>(__pyx_v_array));
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">542</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> <span class="nf">ksize</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_DIM</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="mf">0</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v_ksize = <span class='py_macro_api'>PyArray_DIM</span>(__pyx_v_kernel, 0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">543</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">_mode</span> <span class="o">=</span> <span class="n">extend_mode_to_code</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_f_6pyrost_3bin_9beam_calc_extend_mode_to_code(__pyx_v_mode);<span class='error_goto'> if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 543, __pyx_L1_error)</span>
  __pyx_v__mode = __pyx_t_2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">544</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> *<span class="nf">dims</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3 = __pyx_v_array-&gt;dimensions;
  __pyx_v_dims = __pyx_t_3;
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">545</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span> <span class="nf">out</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">np.ndarray</span><span class="p">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_SimpleNew</span><span class="p">(</span><span class="n">ndim</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_FLOAT64</span><span class="p">)</span></pre>
<pre class='cython code score-7 '>  __pyx_t_1 = <span class='py_c_api'>PyArray_SimpleNew</span>(__pyx_v_ndim, __pyx_v_dims, NPY_FLOAT64);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 545, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = __pyx_t_1;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_out = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">546</span>:     <span class="k">cdef</span> <span class="kt">double</span> *<span class="nf">_out</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">out</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__out = ((double *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_out));
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">547</span>:     <span class="k">cdef</span> <span class="kt">double</span> *<span class="nf">_inp</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">array</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__inp = ((double *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_array));
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">548</span>:     <span class="k">cdef</span> <span class="kt">double</span> *<span class="nf">_krn</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__krn = ((double *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_kernel));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">549</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">fail</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_fail = 0;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">550</span>:     <span class="k">with</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class='cython code score-6 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L5;
        }
        __pyx_L4_error: {
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L1_error;
        }
        __pyx_L5:;
      }
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">551</span>:         <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s">&#39;fftw&#39;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>        __pyx_t_5 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_backend, __pyx_n_u_fftw, Py_EQ)); if (unlikely(__pyx_t_5 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 551, __pyx_L4_error)</span>
        __pyx_t_6 = (__pyx_t_5 != 0);
        if (__pyx_t_6) {
/* … */
          goto __pyx_L6;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">552</span>:             <span class="n">fft_convolve_fftw</span><span class="p">(</span><span class="n">_out</span><span class="p">,</span> <span class="n">_inp</span><span class="p">,</span> <span class="n">_krn</span><span class="p">,</span> <span class="n">isize</span><span class="p">,</span> <span class="n">npts</span><span class="p">,</span> <span class="n">istride</span><span class="p">,</span> <span class="n">ksize</span><span class="p">,</span> <span class="n">_mode</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          fft_convolve_fftw(__pyx_v__out, __pyx_v__inp, __pyx_v__krn, __pyx_v_isize, __pyx_v_npts, __pyx_v_istride, __pyx_v_ksize, __pyx_v__mode, __pyx_v_cval, __pyx_v_num_threads);
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">553</span>:         <span class="k">elif</span> <span class="n">backend</span> <span class="o">==</span> <span class="s">&#39;numpy&#39;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>        __pyx_t_6 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_backend, __pyx_n_u_numpy, Py_EQ)); if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 553, __pyx_L4_error)</span>
        __pyx_t_5 = (__pyx_t_6 != 0);
        if (__pyx_t_5) {
/* … */
          goto __pyx_L6;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">554</span>:             <span class="n">fail</span> <span class="o">=</span> <span class="n">fft_convolve_np</span><span class="p">(</span><span class="n">_out</span><span class="p">,</span> <span class="n">_inp</span><span class="p">,</span> <span class="n">_krn</span><span class="p">,</span> <span class="n">isize</span><span class="p">,</span> <span class="n">npts</span><span class="p">,</span> <span class="n">istride</span><span class="p">,</span> <span class="n">ksize</span><span class="p">,</span> <span class="n">_mode</span><span class="p">,</span> <span class="n">cval</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          __pyx_v_fail = fft_convolve_np(__pyx_v__out, __pyx_v__inp, __pyx_v__krn, __pyx_v_isize, __pyx_v_npts, __pyx_v_istride, __pyx_v_ksize, __pyx_v__mode, __pyx_v_cval);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">555</span>:             <span class="k">if</span> <span class="n">fail</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>          __pyx_t_5 = (__pyx_v_fail != 0);
          if (__pyx_t_5) {
/* … */
          }
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">556</span>:                 <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;NumPy FFT exited with error&#39;</span><span class="p">)</span></pre>
<pre class='cython code score-9 '>            {
                #ifdef WITH_THREAD
                PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                #endif
                /*try:*/ {
                  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_RuntimeError, __pyx_tuple__5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 556, __pyx_L9_error)</span>
                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
                  <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_4, 0, 0, 0);
                  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
                  <span class='error_goto'>__PYX_ERR(0, 556, __pyx_L9_error)</span>
                }
                /*finally:*/ {
                  __pyx_L9_error: {
                    #ifdef WITH_THREAD
                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                    #endif
                    goto __pyx_L4_error;
                  }
                }
            }
</pre><pre class="cython line score-0">&#xA0;<span class="">557</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-26" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">558</span>:             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;{:s} is invalid backend&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backend</span><span class="p">))</span></pre>
<pre class='cython code score-26 '>        /*else*/ {
          {
              #ifdef WITH_THREAD
              PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
              #endif
              /*try:*/ {
                __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_kp_u_s_is_invalid_backend, __pyx_n_s_format);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 558, __pyx_L12_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
                __pyx_t_7 = NULL;
                if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
                  __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
                  if (likely(__pyx_t_7)) {
                    PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
                  }
                }
                __pyx_t_4 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_7, __pyx_v_backend) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_v_backend);
                <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
                if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 558, __pyx_L12_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
                __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_ValueError, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 558, __pyx_L12_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
                <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
                <span class='error_goto'>__PYX_ERR(0, 558, __pyx_L12_error)</span>
              }
              /*finally:*/ {
                __pyx_L12_error: {
                  #ifdef WITH_THREAD
                  <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                  #endif
                  goto __pyx_L4_error;
                }
              }
          }
        }
        __pyx_L6:;
      }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">559</span>:     <span class="k">return</span> <span class="n">out</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_out));
  __pyx_r = __pyx_v_out;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">560</span>: </pre>
<pre class="cython line score-180" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">561</span>: <span class="k">def</span> <span class="nf">make_frames</span><span class="p">(</span><span class="n">pfx</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pfy</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">wfx</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">wfy</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span></pre>
<pre class='cython code score-180 '>/* Python wrapper */
static PyArrayObject *__pyx_pw_6pyrost_3bin_9beam_calc_23make_frames(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6pyrost_3bin_9beam_calc_22make_frames[] = "make_frames(ndarray pfx: np.ndarray, ndarray pfy: np.ndarray, ndarray wfx: np.ndarray, ndarray wfy: np.ndarray, double dx: cython.double, double dy: cython.double, long seed: cython.long, unsigned int num_threads: cython.uint) -&gt; np.ndarray\nGenerate intensity frames from one-dimensional intensity profiles (`pfx`,\n    `pfy`) and whitefield profiles (`wfx`, `wfy`). Intensity profiles resized into\n    the shape of a frame. Poisson noise is applied if `seed` is non-negative.\n\n    Parameters\n    ----------\n    pfx : numpy.ndarray\n        Intensity profile along the x axis.\n    pfy : numpy.ndarray\n        Intensity profile along the y axis.\n    wfx : numpy.ndarray\n        Whitefield profile along the x axis.\n    wfy : numpy.ndarray\n        Whitefield profile along the y axis.\n    dx : float\n        Sampling interval along the x axis [um].\n    dy : float\n        Sampling interval along the y axis [um].\n    seed : int, optional\n        Seed for pseudo-random number generation.\n    num_threads : int, optional\n        Number of threads.\n\n    Returns\n    -------\n    frames : numpy.ndarray\n        Intensity frames.\n    ";
static PyMethodDef __pyx_mdef_6pyrost_3bin_9beam_calc_23make_frames = {"make_frames", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6pyrost_3bin_9beam_calc_23make_frames, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6pyrost_3bin_9beam_calc_22make_frames};
static PyArrayObject *__pyx_pw_6pyrost_3bin_9beam_calc_23make_frames(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_pfx = 0;
  PyArrayObject *__pyx_v_pfy = 0;
  PyArrayObject *__pyx_v_wfx = 0;
  PyArrayObject *__pyx_v_wfy = 0;
  double __pyx_v_dx;
  double __pyx_v_dy;
  long __pyx_v_seed;
  unsigned int __pyx_v_num_threads;
  PyArrayObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("make_frames (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_pfx,&amp;__pyx_n_s_pfy,&amp;__pyx_n_s_wfx,&amp;__pyx_n_s_wfy,&amp;__pyx_n_s_dx,&amp;__pyx_n_s_dy,&amp;__pyx_n_s_seed,&amp;__pyx_n_s_num_threads,0};
    PyObject* values[8] = {0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_pfx)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_pfy)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("make_frames", 1, 8, 8, 1); <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_wfx)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("make_frames", 1, 8, 8, 2); <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_wfy)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("make_frames", 1, 8, 8, 3); <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dx)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("make_frames", 1, 8, 8, 4); <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dy)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("make_frames", 1, 8, 8, 5); <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_seed)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("make_frames", 1, 8, 8, 6); <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_num_threads)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("make_frames", 1, 8, 8, 7); <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "make_frames") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 8) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
      values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
      values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
    }
    __pyx_v_pfx = ((PyArrayObject *)values[0]);
    __pyx_v_pfy = ((PyArrayObject *)values[1]);
    __pyx_v_wfx = ((PyArrayObject *)values[2]);
    __pyx_v_wfy = ((PyArrayObject *)values[3]);
    __pyx_v_dx = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_dx == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 562, __pyx_L3_error)</span>
    __pyx_v_dy = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[5]); if (unlikely((__pyx_v_dy == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 562, __pyx_L3_error)</span>
    __pyx_v_seed = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[6]); if (unlikely((__pyx_v_seed == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 562, __pyx_L3_error)</span>
    __pyx_v_num_threads = <span class='pyx_c_api'>__Pyx_PyInt_As_unsigned_int</span>(values[7]); if (unlikely((__pyx_v_num_threads == (unsigned int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 563, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("make_frames", 1, 8, 8, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.make_frames", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_pfx), __pyx_ptype_5numpy_ndarray, 1, "pfx", 0))) <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_pfy), __pyx_ptype_5numpy_ndarray, 1, "pfy", 0))) <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_wfx), __pyx_ptype_5numpy_ndarray, 1, "wfx", 0))) <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_wfy), __pyx_ptype_5numpy_ndarray, 1, "wfy", 0))) <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_6pyrost_3bin_9beam_calc_22make_frames(__pyx_self, __pyx_v_pfx, __pyx_v_pfy, __pyx_v_wfx, __pyx_v_wfy, __pyx_v_dx, __pyx_v_dy, __pyx_v_seed, __pyx_v_num_threads);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyArrayObject *__pyx_pf_6pyrost_3bin_9beam_calc_22make_frames(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_pfx, PyArrayObject *__pyx_v_pfy, PyArrayObject *__pyx_v_wfx, PyArrayObject *__pyx_v_wfy, double __pyx_v_dx, double __pyx_v_dy, long __pyx_v_seed, unsigned int __pyx_v_num_threads) {
  npy_intp *__pyx_v_xdim;
  npy_intp __pyx_v_ypts;
  npy_intp __pyx_v_fs_size;
  npy_intp __pyx_v_ss_size;
  npy_intp *__pyx_v_dim;
  PyArrayObject *__pyx_v_out = 0;
  double *__pyx_v__out;
  double *__pyx_v__pfx;
  double *__pyx_v__pfy;
  double *__pyx_v__wfx;
  double *__pyx_v__wfy;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("make_frames", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_pfx);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_pfy);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_wfx);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_wfy);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.make_frames", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_out);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_pfx);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_pfy);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_wfx);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_wfy);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__32 = <span class='py_c_api'>PyTuple_Pack</span>(19, __pyx_n_s_pfx, __pyx_n_s_pfy, __pyx_n_s_wfx, __pyx_n_s_wfy, __pyx_n_s_dx, __pyx_n_s_dy, __pyx_n_s_seed, __pyx_n_s_num_threads, __pyx_n_s_xdim, __pyx_n_s_ypts, __pyx_n_s_fs_size, __pyx_n_s_ss_size, __pyx_n_s_dim, __pyx_n_s_out, __pyx_n_s_out_2, __pyx_n_s_pfx_2, __pyx_n_s_pfy_2, __pyx_n_s_wfx_2, __pyx_n_s_wfy_2);<span class='error_goto'> if (unlikely(!__pyx_tuple__32)) __PYX_ERR(0, 561, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__32);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__32);
/* … */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(9);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 561, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_pfx, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_pfy, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_wfx, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_wfy, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_dx, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_dy, __pyx_n_u_double) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_seed, __pyx_n_u_long) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_num_threads, __pyx_kp_u_unsigned_int) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_return, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L1_error)</span>
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_6pyrost_3bin_9beam_calc_23make_frames, 0, __pyx_n_s_make_frames, NULL, __pyx_n_s_pyrost_bin_beam_calc, __pyx_d, ((PyObject *)__pyx_codeobj__33));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 561, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetAnnotationsDict</span>(__pyx_t_3, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_make_frames, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__33 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(8, 0, 19, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__32, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_pyrost_bin_beam_calc_pyx, __pyx_n_s_make_frames, 561, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__33)) __PYX_ERR(0, 561, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">562</span>:                 <span class="n">dx</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="p">,</span> <span class="n">dy</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">double</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">long</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">563</span>:                 <span class="n">num_threads</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">uint</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">564</span>:     <span class="sd">&quot;&quot;&quot;Generate intensity frames from one-dimensional intensity profiles (`pfx`,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">565</span>: <span class="sd">    `pfy`) and whitefield profiles (`wfx`, `wfy`). Intensity profiles resized into</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">566</span>: <span class="sd">    the shape of a frame. Poisson noise is applied if `seed` is non-negative.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">567</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">568</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">569</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">570</span>: <span class="sd">    pfx : numpy.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">571</span>: <span class="sd">        Intensity profile along the x axis.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">572</span>: <span class="sd">    pfy : numpy.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">573</span>: <span class="sd">        Intensity profile along the y axis.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">574</span>: <span class="sd">    wfx : numpy.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">575</span>: <span class="sd">        Whitefield profile along the x axis.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">576</span>: <span class="sd">    wfy : numpy.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">577</span>: <span class="sd">        Whitefield profile along the y axis.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">578</span>: <span class="sd">    dx : float</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">579</span>: <span class="sd">        Sampling interval along the x axis [um].</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">580</span>: <span class="sd">    dy : float</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">581</span>: <span class="sd">        Sampling interval along the y axis [um].</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">582</span>: <span class="sd">    seed : int, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">583</span>: <span class="sd">        Seed for pseudo-random number generation.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">584</span>: <span class="sd">    num_threads : int, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">585</span>: <span class="sd">        Number of threads.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">586</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">587</span>: <span class="sd">    Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">588</span>: <span class="sd">    -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">589</span>: <span class="sd">    frames : numpy.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">590</span>: <span class="sd">        Intensity frames.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">591</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">592</span>:     <span class="n">pfx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_GETCONTIGUOUS</span><span class="p">(</span><span class="n">pfx</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>  __pyx_t_1 = ((PyObject *)<span class='py_macro_api'>PyArray_GETCONTIGUOUS</span>(__pyx_v_pfx));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 592, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_pfx, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">593</span>:     <span class="n">pfx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_Cast</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_FLOAT64</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='py_c_api'>PyArray_Cast</span>(__pyx_v_pfx, NPY_FLOAT64);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 593, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 593, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_pfx, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">594</span>:     <span class="n">pfy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_GETCONTIGUOUS</span><span class="p">(</span><span class="n">pfy</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>  __pyx_t_1 = ((PyObject *)<span class='py_macro_api'>PyArray_GETCONTIGUOUS</span>(__pyx_v_pfy));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 594, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_pfy, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">595</span>:     <span class="n">pfy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_Cast</span><span class="p">(</span><span class="n">pfy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_FLOAT64</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='py_c_api'>PyArray_Cast</span>(__pyx_v_pfy, NPY_FLOAT64);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 595, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 595, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_pfy, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">596</span>:     <span class="n">wfx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_GETCONTIGUOUS</span><span class="p">(</span><span class="n">wfx</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>  __pyx_t_1 = ((PyObject *)<span class='py_macro_api'>PyArray_GETCONTIGUOUS</span>(__pyx_v_wfx));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 596, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_wfx, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">597</span>:     <span class="n">wfx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_Cast</span><span class="p">(</span><span class="n">wfx</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_FLOAT64</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='py_c_api'>PyArray_Cast</span>(__pyx_v_wfx, NPY_FLOAT64);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 597, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 597, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_wfx, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">598</span>:     <span class="n">wfy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_GETCONTIGUOUS</span><span class="p">(</span><span class="n">wfy</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>  __pyx_t_1 = ((PyObject *)<span class='py_macro_api'>PyArray_GETCONTIGUOUS</span>(__pyx_v_wfy));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 598, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_wfy, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">599</span>:     <span class="n">wfy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_Cast</span><span class="p">(</span><span class="n">wfy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_FLOAT64</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='py_c_api'>PyArray_Cast</span>(__pyx_v_wfy, NPY_FLOAT64);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 599, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 599, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_wfy, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">600</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">601</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> *<span class="nf">xdim</span> <span class="o">=</span> <span class="n">pfx</span><span class="o">.</span><span class="n">shape</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_v_pfx-&gt;dimensions;
  __pyx_v_xdim = __pyx_t_2;
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">602</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> <span class="nf">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_SIZE</span><span class="p">(</span><span class="n">pfy</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v_ypts = <span class='py_macro_api'>PyArray_SIZE</span>(__pyx_v_pfy);
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">603</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> <span class="nf">fs_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_SIZE</span><span class="p">(</span><span class="n">wfx</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v_fs_size = <span class='py_macro_api'>PyArray_SIZE</span>(__pyx_v_wfx);
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">604</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> <span class="nf">ss_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_SIZE</span><span class="p">(</span><span class="n">wfy</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v_ss_size = <span class='py_macro_api'>PyArray_SIZE</span>(__pyx_v_wfy);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">605</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> *<span class="nf">dim</span> <span class="o">=</span> <span class="p">[</span><span class="n">xdim</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">ss_size</span><span class="p">,</span> <span class="n">fs_size</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3[0] = (__pyx_v_xdim[0]);
  __pyx_t_3[1] = __pyx_v_ss_size;
  __pyx_t_3[2] = __pyx_v_fs_size;
  __pyx_v_dim = __pyx_t_3;
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">606</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span> <span class="nf">out</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">np.ndarray</span><span class="p">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_SimpleNew</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_FLOAT64</span><span class="p">)</span></pre>
<pre class='cython code score-7 '>  __pyx_t_1 = <span class='py_c_api'>PyArray_SimpleNew</span>(3, __pyx_v_dim, NPY_FLOAT64);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 606, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = __pyx_t_1;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_out = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">607</span>:     <span class="k">cdef</span> <span class="kt">double</span> *<span class="nf">_out</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">out</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__out = ((double *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_out));
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">608</span>:     <span class="k">cdef</span> <span class="kt">double</span> *<span class="nf">_pfx</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">pfx</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__pfx = ((double *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_pfx));
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">609</span>:     <span class="k">cdef</span> <span class="kt">double</span> *<span class="nf">_pfy</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">pfy</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__pfy = ((double *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_pfy));
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">610</span>:     <span class="k">cdef</span> <span class="kt">double</span> *<span class="nf">_wfx</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">wfx</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__wfx = ((double *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_wfx));
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">611</span>:     <span class="k">cdef</span> <span class="kt">double</span> *<span class="nf">_wfy</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">wfy</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__wfy = ((double *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_wfy));
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">612</span>:     <span class="k">with</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class='cython code score-4 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L5;
        }
        __pyx_L5:;
      }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">613</span>:         <span class="n">frames</span><span class="p">(</span><span class="n">_out</span><span class="p">,</span> <span class="n">_pfx</span><span class="p">,</span> <span class="n">_pfy</span><span class="p">,</span> <span class="n">_wfx</span><span class="p">,</span> <span class="n">_wfy</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">xdim</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">dim</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">dim</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">dim</span><span class="p">[</span><span class="mf">2</span><span class="p">],</span> <span class="n">seed</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        frames(__pyx_v__out, __pyx_v__pfx, __pyx_v__pfy, __pyx_v__wfx, __pyx_v__wfy, __pyx_v_dx, __pyx_v_dy, (__pyx_v_xdim[1]), __pyx_v_ypts, (__pyx_v_dim[0]), (__pyx_v_dim[1]), (__pyx_v_dim[2]), __pyx_v_seed, __pyx_v_num_threads);
      }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">614</span>:     <span class="k">return</span> <span class="n">out</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_out));
  __pyx_r = __pyx_v_out;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">615</span>: </pre>
<pre class="cython line score-116" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">616</span>: <span class="k">def</span> <span class="nf">make_whitefield</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">int</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span></pre>
<pre class='cython code score-116 '>/* Python wrapper */
static PyArrayObject *__pyx_pw_6pyrost_3bin_9beam_calc_25make_whitefield(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6pyrost_3bin_9beam_calc_24make_whitefield[] = "make_whitefield(ndarray data: np.ndarray, ndarray mask: np.ndarray, int axis: cython.int = 0, unsigned int num_threads: cython.uint = 1) -&gt; np.ndarray\nGenerate a whitefield using the median filtering along the `axis`.\n\n    Parameters\n    ----------\n    data : numpy.ndarray\n        Intensity frames.\n    mask : numpy.ndarray\n        Bad pixel mask.\n    axis : int, optional\n        Array axis along which median values are calculated.\n    num_threads : int, optional\n        Number of threads.\n\n    Returns\n    -------\n    wfield : numpy.ndarray\n        Whitefield.\n    ";
static PyMethodDef __pyx_mdef_6pyrost_3bin_9beam_calc_25make_whitefield = {"make_whitefield", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6pyrost_3bin_9beam_calc_25make_whitefield, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6pyrost_3bin_9beam_calc_24make_whitefield};
static PyArrayObject *__pyx_pw_6pyrost_3bin_9beam_calc_25make_whitefield(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_data = 0;
  PyArrayObject *__pyx_v_mask = 0;
  int __pyx_v_axis;
  unsigned int __pyx_v_num_threads;
  PyArrayObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("make_whitefield (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_data,&amp;__pyx_n_s_mask,&amp;__pyx_n_s_axis,&amp;__pyx_n_s_num_threads,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_data)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_mask)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("make_whitefield", 0, 2, 4, 1); <span class='error_goto'>__PYX_ERR(0, 616, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_axis);
          if (value) { values[2] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_num_threads);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "make_whitefield") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 616, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_data = ((PyArrayObject *)values[0]);
    __pyx_v_mask = ((PyArrayObject *)values[1]);
    if (values[2]) {
      __pyx_v_axis = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[2]); if (unlikely((__pyx_v_axis == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 616, __pyx_L3_error)</span>
    } else {
      __pyx_v_axis = ((int)((int)0));
    }
    if (values[3]) {
      __pyx_v_num_threads = <span class='pyx_c_api'>__Pyx_PyInt_As_unsigned_int</span>(values[3]); if (unlikely((__pyx_v_num_threads == (unsigned int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 617, __pyx_L3_error)</span>
    } else {
      __pyx_v_num_threads = ((unsigned int)((unsigned int)1));
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("make_whitefield", 0, 2, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 616, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.make_whitefield", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_data), __pyx_ptype_5numpy_ndarray, 1, "data", 0))) <span class='error_goto'>__PYX_ERR(0, 616, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_mask), __pyx_ptype_5numpy_ndarray, 1, "mask", 0))) <span class='error_goto'>__PYX_ERR(0, 616, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_6pyrost_3bin_9beam_calc_24make_whitefield(__pyx_self, __pyx_v_data, __pyx_v_mask, __pyx_v_axis, __pyx_v_num_threads);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyArrayObject *__pyx_pf_6pyrost_3bin_9beam_calc_24make_whitefield(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_data, PyArrayObject *__pyx_v_mask, int __pyx_v_axis, unsigned int __pyx_v_num_threads) {
  int __pyx_v_ndim;
  npy_intp *__pyx_v_dims;
  int __pyx_v_type_num;
  PyArrayObject *__pyx_v_out = 0;
  void *__pyx_v__out;
  void *__pyx_v__data;
  unsigned char *__pyx_v__mask;
  npy_intp __pyx_v_frame_size;
  CYTHON_UNUSED npy_intp __pyx_v_size;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("make_whitefield", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_data);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_mask);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pyrost.bin.beam_calc.make_whitefield", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_out);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_data);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_mask);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__34 = <span class='py_c_api'>PyTuple_Pack</span>(13, __pyx_n_s_data, __pyx_n_s_mask, __pyx_n_s_axis, __pyx_n_s_num_threads, __pyx_n_s_ndim, __pyx_n_s_dims, __pyx_n_s_type_num, __pyx_n_s_out, __pyx_n_s_out_2, __pyx_n_s_data_2, __pyx_n_s_mask_2, __pyx_n_s_frame_size, __pyx_n_s_size);<span class='error_goto'> if (unlikely(!__pyx_tuple__34)) __PYX_ERR(0, 616, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__34);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__34);
/* … */
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(((int)0));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 616, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
/* … */
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 616, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_t_4);
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 616, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_data, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 616, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_mask, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 616, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_axis, __pyx_n_u_int) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 616, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_num_threads, __pyx_kp_u_unsigned_int) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 616, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_return, __pyx_n_u_ndarray) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 616, __pyx_L1_error)</span>
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_6pyrost_3bin_9beam_calc_25make_whitefield, 0, __pyx_n_s_make_whitefield, NULL, __pyx_n_s_pyrost_bin_beam_calc, __pyx_d, ((PyObject *)__pyx_codeobj__35));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 616, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsTuple</span>(__pyx_t_3, __pyx_t_1);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetAnnotationsDict</span>(__pyx_t_3, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_make_whitefield, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 616, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">617</span>:                     <span class="n">num_threads</span><span class="p">:</span> <span class="n">cython</span><span class="o">.</span><span class="n">uint</span><span class="o">=</span><span class="mf">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_unsigned_int</span>(((unsigned int)1));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 617, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
</pre><pre class="cython line score-0">&#xA0;<span class="">618</span>:     <span class="sd">&quot;&quot;&quot;Generate a whitefield using the median filtering along the `axis`.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">619</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">620</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">621</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">622</span>: <span class="sd">    data : numpy.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">623</span>: <span class="sd">        Intensity frames.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">624</span>: <span class="sd">    mask : numpy.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">625</span>: <span class="sd">        Bad pixel mask.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">626</span>: <span class="sd">    axis : int, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">627</span>: <span class="sd">        Array axis along which median values are calculated.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">628</span>: <span class="sd">    num_threads : int, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">629</span>: <span class="sd">        Number of threads.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">630</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">631</span>: <span class="sd">    Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">632</span>: <span class="sd">    -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">633</span>: <span class="sd">    wfield : numpy.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">634</span>: <span class="sd">        Whitefield.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">635</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">636</span>:     <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_GETCONTIGUOUS</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>  __pyx_t_1 = ((PyObject *)<span class='py_macro_api'>PyArray_GETCONTIGUOUS</span>(__pyx_v_data));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 636, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_data, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">637</span>:     <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_GETCONTIGUOUS</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>  __pyx_t_1 = ((PyObject *)<span class='py_macro_api'>PyArray_GETCONTIGUOUS</span>(__pyx_v_mask));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 637, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_mask, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">638</span>: </pre>
<pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">639</span>:     <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_ISBOOL</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span></pre>
<pre class='cython code score-1 '>  __pyx_t_2 = ((!(<span class='py_macro_api'>PyArray_ISBOOL</span>(__pyx_v_mask) != 0)) != 0);
  if (unlikely(__pyx_t_2)) {
/* … */
  }
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">640</span>:         <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;mask array must be of boolean type&#39;</span><span class="p">)</span></pre>
<pre class='cython code score-10 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_TypeError, __pyx_tuple__6, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 640, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='error_goto'>__PYX_ERR(0, 640, __pyx_L1_error)</span>
/* … */
  __pyx_tuple__6 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_u_mask_array_must_be_of_boolean_ty);<span class='error_goto'> if (unlikely(!__pyx_tuple__6)) __PYX_ERR(0, 640, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__6);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">641</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3 = __pyx_v_data-&gt;nd;
  __pyx_v_ndim = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">642</span>:     <span class="k">if</span> <span class="n">memcmp</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">*</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">npy_intp</span><span class="p">)):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = (memcmp(__pyx_v_data-&gt;dimensions, __pyx_v_mask-&gt;dimensions, (__pyx_v_ndim * (sizeof(npy_intp)))) != 0);
  if (unlikely(__pyx_t_2)) {
/* … */
  }
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">643</span>:         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;mask and data arrays must have identical shapes&#39;</span><span class="p">)</span></pre>
<pre class='cython code score-10 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_ValueError, __pyx_tuple__7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 643, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='error_goto'>__PYX_ERR(0, 643, __pyx_L1_error)</span>
/* … */
  __pyx_tuple__7 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_u_mask_and_data_arrays_must_have_i);<span class='error_goto'> if (unlikely(!__pyx_tuple__7)) __PYX_ERR(0, 643, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__7);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">644</span>:     <span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span> <span class="k">if</span> <span class="n">axis</span> <span class="o">&gt;=</span> <span class="mf">0</span> <span class="k">else</span> <span class="n">ndim</span> <span class="o">+</span> <span class="n">axis</span></pre>
<pre class='cython code score-0 '>  if (((__pyx_v_axis &gt;= 0) != 0)) {
    __pyx_t_3 = __pyx_v_axis;
  } else {
    __pyx_t_3 = (__pyx_v_ndim + __pyx_v_axis);
  }
  __pyx_v_axis = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">645</span>:     <span class="k">if</span> <span class="n">axis</span> <span class="o">!=</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_axis != 0) != 0);
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">646</span>:         <span class="n">data</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">np.ndarray</span><span class="p">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_SwapAxes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="mf">0</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>    __pyx_t_1 = <span class='py_c_api'>PyArray_SwapAxes</span>(__pyx_v_data, __pyx_v_axis, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 646, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_4 = __pyx_t_1;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_data, ((PyArrayObject *)__pyx_t_4));
    __pyx_t_4 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">647</span>:         <span class="n">mask</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">np.ndarray</span><span class="p">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_SwapAxes</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="mf">0</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>    __pyx_t_4 = <span class='py_c_api'>PyArray_SwapAxes</span>(__pyx_v_mask, __pyx_v_axis, 0);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 647, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_1 = __pyx_t_4;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_mask, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">648</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> *<span class="nf">dims</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span></pre>
<pre class='cython code score-0 '>  __pyx_t_5 = __pyx_v_data-&gt;dimensions;
  __pyx_v_dims = __pyx_t_5;
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">649</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">type_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_TYPE</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v_type_num = <span class='py_macro_api'>PyArray_TYPE</span>(__pyx_v_data);
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">650</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span> <span class="nf">out</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">np.ndarray</span><span class="p">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_SimpleNew</span><span class="p">(</span><span class="n">ndim</span> <span class="o">-</span> <span class="mf">1</span><span class="p">,</span> <span class="n">dims</span> <span class="o">+</span> <span class="mf">1</span><span class="p">,</span> <span class="n">type_num</span><span class="p">)</span></pre>
<pre class='cython code score-7 '>  __pyx_t_1 = <span class='py_c_api'>PyArray_SimpleNew</span>((__pyx_v_ndim - 1), (__pyx_v_dims + 1), __pyx_v_type_num);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 650, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = __pyx_t_1;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_out = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">651</span>:     <span class="k">cdef</span> <span class="kt">void</span> *<span class="nf">_out</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">void</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">out</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__out = ((void *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_out));
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">652</span>:     <span class="k">cdef</span> <span class="kt">void</span> *<span class="nf">_data</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">void</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__data = ((void *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_data));
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">653</span>:     <span class="k">cdef</span> <span class="kt">unsigned</span> <span class="kt">char</span> *<span class="nf">_mask</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nb">unsigned</span> <span class="n">char</span> <span class="o">*&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_DATA</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  __pyx_v__mask = ((unsigned char *)<span class='py_macro_api'>PyArray_DATA</span>(__pyx_v_mask));
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">654</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> <span class="nf">frame_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">PyArray_SIZE</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">//</span> <span class="n">dims</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-1 '>  __pyx_v_frame_size = (<span class='py_macro_api'>PyArray_SIZE</span>(__pyx_v_data) / (__pyx_v_dims[0]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">655</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">npy_intp</span> <span class="nf">size</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_size = 0;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">656</span>:     <span class="k">with</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class='cython code score-6 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L8;
        }
        __pyx_L7_error: {
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L1_error;
        }
        __pyx_L8:;
      }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">657</span>:         <span class="k">if</span> <span class="n">type_num</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_FLOAT64</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        switch (__pyx_v_type_num) {
          case NPY_FLOAT64:
/* … */
          break;
          case NPY_FLOAT32:
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">658</span>:                 <span class="n">whitefield</span><span class="p">(</span><span class="n">_out</span><span class="p">,</span> <span class="n">_data</span><span class="p">,</span> <span class="n">_mask</span><span class="p">,</span> <span class="n">dims</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">frame_size</span><span class="p">,</span> <span class="mf">8</span><span class="p">,</span> <span class="n">compare_double</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          whitefield(__pyx_v__out, __pyx_v__data, __pyx_v__mask, (__pyx_v_dims[0]), __pyx_v_frame_size, 8, compare_double, __pyx_v_num_threads);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">659</span>:         <span class="k">elif</span> <span class="n">type_num</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_FLOAT32</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>          break;
          case NPY_INT32:
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">660</span>:                 <span class="n">whitefield</span><span class="p">(</span><span class="n">_out</span><span class="p">,</span> <span class="n">_data</span><span class="p">,</span> <span class="n">_mask</span><span class="p">,</span> <span class="n">dims</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">frame_size</span><span class="p">,</span> <span class="mf">4</span><span class="p">,</span> <span class="n">compare_float</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          whitefield(__pyx_v__out, __pyx_v__data, __pyx_v__mask, (__pyx_v_dims[0]), __pyx_v_frame_size, 4, compare_float, __pyx_v_num_threads);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">661</span>:         <span class="k">elif</span> <span class="n">type_num</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">NPY_INT32</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>          break;
          default:
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">662</span>:                 <span class="n">whitefield</span><span class="p">(</span><span class="n">_out</span><span class="p">,</span> <span class="n">_data</span><span class="p">,</span> <span class="n">_mask</span><span class="p">,</span> <span class="n">dims</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">frame_size</span><span class="p">,</span> <span class="mf">4</span><span class="p">,</span> <span class="n">compare_long</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          whitefield(__pyx_v__out, __pyx_v__data, __pyx_v__mask, (__pyx_v_dims[0]), __pyx_v_frame_size, 4, compare_long, __pyx_v_num_threads);
</pre><pre class="cython line score-0">&#xA0;<span class="">663</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-29" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">664</span>:             <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;data argument has incompatible type: {:s}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span></pre>
<pre class='cython code score-29 '>          {
              #ifdef WITH_THREAD
              PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
              #endif
              /*try:*/ {
                __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_kp_u_data_argument_has_incompatible_t, __pyx_n_s_format);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 664, __pyx_L10_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
                __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_data), __pyx_n_s_dtype);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 664, __pyx_L10_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
                __pyx_t_7 = NULL;
                if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
                  __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
                  if (likely(__pyx_t_7)) {
                    PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
                  }
                }
                __pyx_t_4 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_7, __pyx_t_6) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_6);
                <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
                if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 664, __pyx_L10_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
                __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_TypeError, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 664, __pyx_L10_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
                <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
                <span class='error_goto'>__PYX_ERR(0, 664, __pyx_L10_error)</span>
              }
              /*finally:*/ {
                __pyx_L10_error: {
                  #ifdef WITH_THREAD
                  <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                  #endif
                  goto __pyx_L7_error;
                }
              }
          }
          break;
        }
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">665</span>:     <span class="k">if</span> <span class="n">axis</span> <span class="o">!=</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_axis != 0) != 0);
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">666</span>:         <span class="n">data</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">np.ndarray</span><span class="p">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_SwapAxes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mf">0</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>    __pyx_t_1 = <span class='py_c_api'>PyArray_SwapAxes</span>(__pyx_v_data, 0, __pyx_v_axis);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 666, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_4 = __pyx_t_1;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_data, ((PyArrayObject *)__pyx_t_4));
    __pyx_t_4 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">667</span>:         <span class="n">mask</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">np.ndarray</span><span class="p">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">PyArray_SwapAxes</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="mf">0</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>    __pyx_t_4 = <span class='py_c_api'>PyArray_SwapAxes</span>(__pyx_v_mask, 0, __pyx_v_axis);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 667, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_1 = __pyx_t_4;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_mask, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">668</span>:     <span class="k">return</span> <span class="n">out</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_out));
  __pyx_r = __pyx_v_out;
  goto __pyx_L0;
</pre></div></body></html>
